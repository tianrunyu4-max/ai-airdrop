# AI学习卡 V4.3 参数升级

**升级时间**：2025-10-15  
**版本**：V4.2 → V4.3  
**核心变更**：调整直推加速释放率，提升激励效果

---

## 🔄 参数变更对比

### 释放率规则

#### ❌ V4.2（旧版）

| 直推数 | 释放率 | 计算公式 |
|--------|-------|---------|
| 0个 | 1% | 基础1% |
| 1个 | 2% | 1% + 1% |
| 2个 | 3% | 1% + 2% |
| 3个 | 4% | 1% + 3% |
| ... | ... | ... |
| **9个+** | **10%** | **封顶** |

**公式**：`rate = min(1% + 直推数 × 1%, 10%)`

#### ✅ V4.3（新版）

| 直推数 | 释放率 | 计算公式 |
|--------|-------|---------|
| **0个** | **1%** | 基础1% |
| **1个** | **3%** | 1% + 2% |
| **2个** | **6%** | 1% + 5% |
| **3个** | **9%** | 1% + 8% |
| **4个** | **12%** | 1% + 11% |
| **5个+** | **15%** | **封顶** |

**公式**：
```typescript
if (count === 0) {
  rate = 1%
} else {
  rate = min(1% + 1% × (3 × count - 1), 15%)
}
```

---

## 📊 每日释放量对比

### V4.2 vs V4.3

| 直推数 | V4.2释放率 | V4.2日释放 | V4.3释放率 | V4.3日释放 | 提升 |
|--------|----------|-----------|----------|-----------|------|
| 0个 | 1% | 3积分/0.168U | 1% | 3积分/0.168U | 0% |
| 1个 | 2% | 6积分/0.336U | **3%** | **9积分/0.504U** | **+50%** |
| 2个 | 3% | 9积分/0.504U | **6%** | **18积分/1.008U** | **+100%** |
| 3个 | 4% | 12积分/0.672U | **9%** | **27积分/1.512U** | **+125%** |
| 4个 | 5% | 15积分/0.84U | **12%** | **36积分/2.016U** | **+140%** |
| 5个 | 6% | 18积分/1.008U | **15%** | **45积分/2.52U** | **+150%** |
| 6个 | 7% | 21积分/1.176U | **15%** | **45积分/2.52U** | **+114%** |
| 7个 | 8% | 24积分/1.344U | **15%** | **45积分/2.52U** | **+87%** |
| 8个 | 9% | 27积分/1.512U | **15%** | **45积分/2.52U** | **+67%** |
| 9个 | 10% | 30积分/1.68U | **15%** | **45积分/2.52U** | **+50%** |

**说明**：
- 日释放 = 300积分 × 释放率
- 日到账U = 日释放 × 70% × 0.08

---

## 💰 收益提升分析

### 场景1：新用户（0个直推）

```
V4.2：1% → 3积分/天 → 0.168U/天 → 100天出局
V4.3：1% → 3积分/天 → 0.168U/天 → 100天出局
提升：0%（保持不变）
```

### 场景2：1个直推

```
V4.2：2% → 6积分/天 → 0.336U/天 → 50天出局
V4.3：3% → 9积分/天 → 0.504U/天 → 33天出局
提升：+50%收益，出局时间缩短34%
```

### 场景3：2个直推

```
V4.2：3% → 9积分/天 → 0.504U/天 → 33天出局
V4.3：6% → 18积分/天 → 1.008U/天 → 17天出局
提升：+100%收益，出局时间缩短48%
```

### 场景4：3个直推

```
V4.2：4% → 12积分/天 → 0.672U/天 → 25天出局
V4.3：9% → 27积分/天 → 1.512U/天 → 11天出局
提升：+125%收益，出局时间缩短56%
```

### 场景5：4个直推

```
V4.2：5% → 15积分/天 → 0.84U/天 → 20天出局
V4.3：12% → 36积分/天 → 2.016U/天 → 8天出局
提升：+140%收益，出局时间缩短60%
```

### 场景6：5个直推（新上限）

```
V4.2：6% → 18积分/天 → 1.008U/天 → 17天出局
V4.3：15% → 45积分/天 → 2.52U/天 → 7天出局
提升：+150%收益，出局时间缩短58%
```

---

## 🎯 升级优势

### 1. 大幅提升推广激励

**V4.2**：每多1个直推 → +1%释放率  
**V4.3**：
- 0→1个：+2%（+200%提升）
- 1→2个：+3%（+150%提升）
- 2→3个：+3%（+50%提升）
- 3→4个：+3%（+25%提升）
- 4→5个：+3%（+20%提升）

### 2. 降低封顶门槛

**V4.2**：需要9个直推达到10%上限  
**V4.3**：只需5个直推达到15%上限

**效果**：
- 封顶更容易达成（9个→5个）
- 上限更高（10%→15%）
- 推广动力更强

### 3. 加快资金流转

**平均出局时间**（假设有直推）：

| 直推数 | V4.2出局 | V4.3出局 | 缩短 |
|--------|---------|---------|------|
| 1个 | 50天 | 33天 | -34% |
| 2个 | 33天 | 17天 | -48% |
| 3个 | 25天 | 11天 | -56% |
| 4个 | 20天 | 8天 | -60% |
| 5个 | 17天 | 7天 | -58% |

**效果**：
- 资金周转更快
- 用户体验更好
- 系统更活跃

### 4. 保持0直推基础

**V4.2**：0个直推 = 1%  
**V4.3**：0个直推 = 1%

**效果**：保护新用户基础收益不变

---

## 🔧 技术实现

### 1. 配置文件（`src/config/mining.ts`）

```typescript
// V4.3 释放规则
RELEASE: {
  BASE_RATE: 0.01,              // 基础释放率1%/天（0个直推）
  // 加速规则：1个3%，2个6%，3个9%，4个12%，5个15%
  // 公式：rate = 0.01 + 0.01 * (3 * count - 1) when count > 0
  MAX_RATE: 0.15,               // 最高释放率15%（5个直推封顶）
  MAX_REFERRALS: 5,             // 最多计算5个直推
  REQUIRE_CHECKIN: true,
  TIME: '00:00',
  TIMEZONE: 'Asia/Shanghai'
}
```

### 2. 后端服务（`src/services/MiningService.ts`）

```typescript
/**
 * V4.3 计算释放率（0个1%，1个3%，2个6%，3个9%，4个12%，5个15%封顶）
 */
private static async calculateReleaseRate(userId: string): Promise<number> {
  // 1. 查询直推AI代理数量
  const { count } = await supabase
    .from('users')
    .select('id', { count: 'exact', head: true })
    .eq('inviter_id', userId)
    .eq('is_agent', true)

  const referralCount = count || 0

  // 2. 计算释放率
  let rate: number
  if (referralCount === 0) {
    rate = 0.01 // 1%
  } else {
    const boost = 0.01 * (3 * Math.min(referralCount, 5) - 1)
    rate = Math.min(0.01 + boost, 0.15)
  }

  console.log(`✅ V4.3释放率: ${referralCount}个直推 = ${(rate * 100).toFixed(0)}%`)
  return rate
}
```

### 3. 前端计算（`src/views/points/PointsView.vue`）

```typescript
// V4.3 计算释放率（0个1%，1个3%，2个6%，3个9%，4个12%，5个15%封顶）
const calculateReleaseRate = async () => {
  // 统计直推数量...
  
  // 计算释放率
  let rate: number
  if (referralCount === 0) {
    rate = 0.01
  } else {
    const count = Math.min(referralCount, 5)
    const boost = 0.01 * (3 * count - 1)
    rate = Math.min(0.01 + boost, 0.15)
  }
  releaseRate.value = rate
}
```

### 4. 前端显示更新

#### 购买区参数卡片

```vue
<div>基础释放：1%/天（0个直推）</div>
<div>直推加速：1→3→15%（5个封顶）</div>
```

#### 释放量对照表

```
0个直推：1% → 3积分/天 → 0.168U
1个直推：3% → 9积分/天 → 0.504U
2个直推：6% → 18积分/天 → 1.008U
3个直推：9% → 27积分/天 → 1.512U
4个直推：12% → 36积分/天 → 2.016U
5个直推：15% → 45积分/天 → 2.52U（封顶）
```

#### 签到区说明

```
直推加速：0个1%，1个3%，2个6%，3个9%，4个12%，5个15%
```

---

## 📦 修改的文件

1. ✅ `src/config/mining.ts`
   - 更新版本号：V4.2 → V4.3
   - 修改释放规则注释和参数
   - 更新 `MAX_RATE: 0.10 → 0.15`
   - 更新 `MAX_REFERRALS: 9 → 5`

2. ✅ `src/services/MiningService.ts`
   - 重写 `calculateReleaseRate()` 函数
   - 使用新的释放率计算公式
   - 更新日志输出

3. ✅ `src/views/points/PointsView.vue`
   - 更新 `calculateReleaseRate()` 函数
   - 修改释放量对照表（6行数据）
   - 更新购买区参数显示
   - 修改签到区说明文字
   - 更新banner："1-10%释放" → "1-15%释放"

---

## 🧪 测试建议

### 1. 释放率计算测试

- [ ] 0个直推：1%
- [ ] 1个直推：3%
- [ ] 2个直推：6%
- [ ] 3个直推：9%
- [ ] 4个直推：12%
- [ ] 5个直推：15%
- [ ] 6个直推：15%（封顶）

### 2. 释放量测试

- [ ] 1%：3积分/天
- [ ] 3%：9积分/天
- [ ] 6%：18积分/天
- [ ] 9%：27积分/天
- [ ] 12%：36积分/天
- [ ] 15%：45积分/天

### 3. 到账测试

- [ ] 3积分 × 70% = 2.1积分 → 0.168U
- [ ] 9积分 × 70% = 6.3积分 → 0.504U
- [ ] 18积分 × 70% = 12.6积分 → 1.008U
- [ ] 27积分 × 70% = 18.9积分 → 1.512U
- [ ] 36积分 × 70% = 25.2积分 → 2.016U
- [ ] 45积分 × 70% = 31.5积分 → 2.52U

### 4. 控制台日志

```
✅ 预期输出：
✅ V4.3释放率: X个直推 = X%
```

---

## 💡 用户影响分析

### 积极影响

1. **推广动力大幅提升**
   - 1个直推收益+50%
   - 2个直推收益+100%
   - 更容易吸引新用户

2. **出局周期缩短**
   - 平均出局时间减少40-60%
   - 资金流转更快
   - 复购意愿更强

3. **封顶门槛降低**
   - 9个直推 → 5个直推
   - 更容易达到最高收益
   - 用户成就感更强

4. **收益差距拉大**
   - 激励推广行为
   - 奖励优质用户
   - 提升系统活跃度

### 需要注意

1. **系统通胀风险**
   - 日释放总量可能增加
   - 需要监控积分总量
   - 确保30%销毁机制有效

2. **新老用户差距**
   - 有直推的老用户收益大增
   - 无直推的新用户保持不变
   - 可能需要新手引导优化

3. **出局周期监控**
   - 7-100天出局周期
   - 需要观察实际数据
   - 必要时微调参数

---

## 🎉 升级总结

### 核心改进

```
V4.2 → V4.3

释放率上限：10% → 15% (+50%)
封顶门槛：9个直推 → 5个直推 (-44%)
推广激励：线性增长 → 加速增长 (+150%)
日均收益：0.168-1.68U → 0.168-2.52U (+50%)
出局周期：10-100天 → 7-100天 (最快-30%)
```

### 经济模型

```
单张学习卡（5个直推）：
投入：8U
产出：300积分 → 210积分到账 → 16.8U
日收益：2.52U
出局：7天
收益率：110%
年化：5700%+
```

### 推广激励

```
直推收益对比（每张卡）：

0→1个：+0.336U/天（+200%）
1→2个：+0.504U/天（+100%）
2→3个：+0.504U/天（+50%）
3→4个：+0.504U/天（+33%）
4→5个：+0.504U/天（+25%）
```

---

**V4.3升级完成！大幅提升直推激励，加快资金流转，优化用户体验。** 🚀


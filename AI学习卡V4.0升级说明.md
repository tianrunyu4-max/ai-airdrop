# ğŸ”¥ AIå­¦ä¹ å¡ V4.0 é‡å¤§å‡çº§

> **æ›´æ–°æ—¥æœŸ**ï¼š2025-10-11  
> **ç‰ˆæœ¬**ï¼šV4.0  
> **çŠ¶æ€**ï¼šğŸš§ é…ç½®å·²æ›´æ–°ï¼Œä»£ç å¾…å®Œå–„

---

## ğŸ“‹ æ ¸å¿ƒå˜æ›´å¯¹æ¯”

| é¡¹ç›® | V3.0ï¼ˆæ—§ï¼‰ | V4.0ï¼ˆæ–°ï¼‰ | å˜åŒ–è¯´æ˜ |
|------|-----------|-----------|----------|
| **åç§°** | AIå­¦ä¹ æœº | **AIå­¦ä¹ å¡** | æ”¹å |
| **è·å¾—æ–¹å¼** | ç¬¬ä¸€æ¬¡å…è´¹é€ | **æˆä¸ºAIä»£ç†è‡ªåŠ¨é€100ç§¯åˆ†** | è‡ªåŠ¨èµ é€ |
| **å…‘æ¢æ–¹å¼** | 100ç§¯åˆ† | **7Uä½™é¢å…‘æ¢100ç§¯åˆ†** | å¯ç”¨Uä½™é¢å…‘æ¢ |
| **é‡Šæ”¾æ¡ä»¶** | è‡ªåŠ¨é‡Šæ”¾ | **å¿…é¡»æ¯æ—¥ç­¾åˆ°** | ä¸ç­¾åˆ°ä¸é‡Šæ”¾ |
| **åŸºç¡€é‡Šæ”¾ç‡** | 10%/å¤© | **2%/å¤©** | é™ä½10å€ |
| **å‡ºå±€å€æ•°** | 2å€ | **10å€** | æé«˜5å€ |
| **å‡ºå±€æ—¶é—´** | 20å¤© | **500å¤©ï¼ˆ2%ï¼‰ or 50å¤©ï¼ˆ20%ï¼‰** | çœ‹ç›´æ¨æ•°é‡ |
| **ç›´æ¨åŠ é€Ÿ** | âŒ å–æ¶ˆ | **+3%/äººï¼Œæœ€é«˜20%** | æ¢å¤åŠ é€Ÿæœºåˆ¶ |
| **ç§¯åˆ†åˆ†é…** | 70%U + 30%äº’è½¬ | **70%U + 30%é”€æ¯** | è‡ªåŠ¨é”€æ¯ï¼Œé˜²é€šèƒ€ |
| **å¤åˆ©æ»šå­˜** | âœ… æœ‰ | **âŒ å–æ¶ˆ** | ç®€åŒ–é€»è¾‘ |
| **é‡å¯æœºåˆ¶** | æ‰‹åŠ¨ | **è‡ªåŠ¨+æ‰‹åŠ¨** | æ€»é‡Šæ”¾>æ–°ç§¯åˆ†è‡ªåŠ¨é‡å¯ |

---

## ğŸ¯ æ–°é€»è¾‘è¯¦è§£

### 1ï¸âƒ£ æˆä¸ºAIä»£ç†è‡ªåŠ¨é€100ç§¯åˆ†

```
ç”¨æˆ·æ”¯ä»˜30UåŠ å…¥Binaryç³»ç»Ÿ
  â†“
ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼š
  - è®¾ç½® is_agent = true
  - è‡ªåŠ¨èµ é€ 100 transfer_points
  - å¯ç«‹å³æ¿€æ´»ç¬¬ä¸€å¼ å­¦ä¹ å¡
  â†“
ç”¨æˆ·æ— éœ€é¢å¤–æ“ä½œå³å¯å¼€å§‹å­¦ä¹ 
```

### 2ï¸âƒ£ 7Uä½™é¢å…‘æ¢100ç§¯åˆ†

```
å…‘æ¢å…¥å£ï¼šAIå­¦ä¹ é¡µé¢ â†’ å…‘æ¢å­¦ä¹ å¡

ç”¨æˆ·æ“ä½œï¼š
  1. é€‰æ‹©å…‘æ¢æ•°é‡ï¼ˆ1-10å¼ ï¼‰
  2. æ¶ˆè€— 7U Ã— æ•°é‡
  3. è·å¾— 100ç§¯åˆ† Ã— æ•°é‡
  â†“
ç³»ç»Ÿæ‰§è¡Œï¼š
  - æ‰£é™¤Uä½™é¢
  - å¢åŠ transfer_points
  - åˆ›å»ºå­¦ä¹ å¡è®°å½•
```

### 3ï¸âƒ£ æ¯æ—¥ç­¾åˆ°é‡Šæ”¾æœºåˆ¶

```
æ¯å¤©ç”¨æˆ·éœ€è¦ï¼š
  1. è¿›å…¥AIå­¦ä¹ é¡µé¢
  2. ç‚¹å‡»"ç­¾åˆ°å¯åŠ¨"æŒ‰é’®
  3. ç­¾åˆ°æˆåŠŸåå½“å¤©é‡Šæ”¾ç§¯åˆ†
  â†“
å¦‚æœä¸ç­¾åˆ°ï¼š
  - å½“å¤©ä¸é‡Šæ”¾ä»»ä½•ç§¯åˆ†
  - å­¦ä¹ å¡çŠ¶æ€ï¼šinactiveï¼ˆæœªæ¿€æ´»ï¼‰
  - ä¸å½±å“åç»­ç­¾åˆ°
```

### 4ï¸âƒ£ é‡Šæ”¾ç‡è®¡ç®—

```
é‡Šæ”¾ç‡ = åŸºç¡€é‡Šæ”¾ç‡ + ç›´æ¨åŠ é€Ÿ

åŸºç¡€é‡Šæ”¾ç‡ï¼š2%/å¤©

ç›´æ¨åŠ é€Ÿï¼š
  - æ¯ç›´æ¨1ä¸ªAIä»£ç† +3%
  - æœ€å¤šè®¡ç®—6ä¸ªç›´æ¨
  - æœ€é«˜åŠ é€Ÿ 18%ï¼ˆ6 Ã— 3%ï¼‰
  - æœ€é«˜é‡Šæ”¾ç‡ 20%ï¼ˆ2% + 18%ï¼‰

ç¤ºä¾‹ï¼š
  0ä¸ªç›´æ¨ï¼š2%/å¤©ï¼ˆ500å¤©å‡ºå±€ï¼‰
  1ä¸ªç›´æ¨ï¼š5%/å¤©ï¼ˆ200å¤©å‡ºå±€ï¼‰
  2ä¸ªç›´æ¨ï¼š8%/å¤©ï¼ˆ125å¤©å‡ºå±€ï¼‰
  3ä¸ªç›´æ¨ï¼š11%/å¤©ï¼ˆ91å¤©å‡ºå±€ï¼‰
  4ä¸ªç›´æ¨ï¼š14%/å¤©ï¼ˆ71å¤©å‡ºå±€ï¼‰
  5ä¸ªç›´æ¨ï¼š17%/å¤©ï¼ˆ59å¤©å‡ºå±€ï¼‰
  6ä¸ª+ç›´æ¨ï¼š20%/å¤©ï¼ˆ50å¤©å‡ºå±€ï¼‰
```

### 5ï¸âƒ£ æ¯æ—¥æ”¶ç›Šåˆ†é…

```
å‡è®¾ï¼š100ç§¯åˆ†å­¦ä¹ å¡ï¼Œé‡Šæ”¾ç‡10%ï¼ˆ2%åŸºç¡€+2ä¸ªç›´æ¨ï¼‰

æ¯æ—¥ç­¾åˆ°åé‡Šæ”¾ï¼š10ç§¯åˆ†
  â”œâ”€ 70% â†’ Uä½™é¢ï¼š7ç§¯åˆ† = 0.49Uï¼ˆç›´æ¥åˆ°è´¦ï¼‰
  â””â”€ 30% â†’ è‡ªåŠ¨é”€æ¯ï¼š3ç§¯åˆ†ï¼ˆæ¸…0ï¼Œé˜²é€šèƒ€ï¼‰

10å€å‡ºå±€åæ€»æ”¶ç›Šï¼š
  - é‡Šæ”¾æ€»ç§¯åˆ†ï¼š1000ç§¯åˆ†
  - åˆ°è´¦Uä½™é¢ï¼š1000 Ã— 70% Ã— 0.07 = 49U
  - é”€æ¯ç§¯åˆ†ï¼š1000 Ã— 30% = 300ç§¯åˆ†
  - æŠ•å…¥äº§å‡ºæ¯”ï¼š49U Ã· 7U = 7å€
```

### 6ï¸âƒ£ è‡ªåŠ¨é‡å¯æœºåˆ¶ï¼ˆé˜²æ³¡æ²«ï¼‰

```
åç«¯å®šæ—¶ä»»åŠ¡æ£€æµ‹ï¼š
  IF æ€»é‡Šæ”¾ç§¯åˆ† > æ–°å……å€¼ç§¯åˆ† THEN
    è§¦å‘è‡ªåŠ¨é‡å¯ï¼š
      1. æ‰€æœ‰å­¦ä¹ å¡ç§¯åˆ†æ¸…0é”€æ¯
      2. ä¿ç•™Uä½™é¢
      3. å¯ç»§ç»­å…‘æ¢æ–°å­¦ä¹ å¡
      4. ç»§ç»­é‡Šæ”¾
  END IF

ç›®çš„ï¼š
  - é˜²æ­¢ç§¯åˆ†æ³¡æ²«è¿‡å¤§
  - ä¿æŒç³»ç»Ÿå¥åº·è¿è¡Œ
  - é¿å…é€šè´§è†¨èƒ€
```

---

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. é…ç½®æ–‡ä»¶ï¼ˆå·²å®Œæˆ âœ…ï¼‰
- `src/config/mining.ts` - å·²æ›´æ–°ä¸ºV4.0é…ç½®

### 2. æ•°æ®åº“è¡¨ï¼ˆå¾…æ·»åŠ ï¼‰
éœ€è¦åœ¨ `mining_machines` è¡¨æ·»åŠ å­—æ®µï¼š
```sql
ALTER TABLE mining_machines ADD COLUMN IF NOT EXISTS
  last_checkin_date DATE,           -- æœ€åç­¾åˆ°æ—¥æœŸ
  checkin_count INTEGER DEFAULT 0,  -- æ€»ç­¾åˆ°æ¬¡æ•°
  is_checked_in_today BOOLEAN DEFAULT FALSE; -- ä»Šå¤©æ˜¯å¦å·²ç­¾åˆ°
```

### 3. åç«¯æœåŠ¡ï¼ˆå¾…ä¿®æ”¹ï¼‰

#### A. æˆä¸ºä»£ç†æ—¶è‡ªåŠ¨é€ç§¯åˆ†
```typescript
// src/services/BinaryService.ts - joinBinary()
async joinBinary(userId: string) {
  // ... ç°æœ‰é€»è¾‘
  
  // æ–°å¢ï¼šè‡ªåŠ¨èµ é€100ç§¯åˆ†
  await WalletManager.add(
    userId,
    100,
    'transfer_points',
    'binary_auto_gift',
    'åŠ å…¥Binaryç³»ç»Ÿèµ é€'
  )
}
```

#### B. å…‘æ¢å­¦ä¹ å¡ï¼ˆUä½™é¢ï¼‰
```typescript
// src/services/MiningService.ts
async exchangeCard(userId: string, quantity: number) {
  const cost = 7 * quantity
  const points = 100 * quantity
  
  // 1. æ‰£é™¤Uä½™é¢
  await WalletManager.deduct(userId, cost, 'u_balance', 'exchange_card')
  
  // 2. å¢åŠ ç§¯åˆ†
  await WalletManager.add(userId, points, 'transfer_points', 'exchange_card')
  
  // 3. åˆ›å»ºå­¦ä¹ å¡
  for (let i = 0; i < quantity; i++) {
    await this.createCard(userId, points / quantity)
  }
}
```

#### C. ç­¾åˆ°é‡Šæ”¾
```typescript
// src/services/MiningService.ts
async checkin(userId: string) {
  const today = new Date().toISOString().split('T')[0]
  
  // 1. æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç­¾åˆ°
  const { data: cards } = await supabase
    .from('mining_machines')
    .select('*')
    .eq('user_id', userId)
    .eq('status', 'active')
  
  for (const card of cards) {
    if (card.last_checkin_date === today) {
      throw new Error('ä»Šå¤©å·²ç­¾åˆ°')
    }
    
    // 2. æ›´æ–°ç­¾åˆ°çŠ¶æ€
    await supabase
      .from('mining_machines')
      .update({
        last_checkin_date: today,
        checkin_count: card.checkin_count + 1,
        is_checked_in_today: true
      })
      .eq('id', card.id)
    
    // 3. è®¡ç®—é‡Šæ”¾ç‡
    const rate = await this.calculateReleaseRate(userId)
    
    // 4. æ‰§è¡Œé‡Šæ”¾
    await this.releasePoints(card.id, rate)
  }
}
```

#### D. è®¡ç®—é‡Šæ”¾ç‡ï¼ˆå«ç›´æ¨åŠ é€Ÿï¼‰
```typescript
async calculateReleaseRate(userId: string): Promise<number> {
  // 1. åŸºç¡€é‡Šæ”¾ç‡
  let rate = AILearningConfig.RELEASE.BASE_RATE // 2%
  
  // 2. æŸ¥è¯¢ç›´æ¨AIä»£ç†æ•°é‡
  const { count } = await supabase
    .from('users')
    .select('id', { count: 'exact' })
    .eq('inviter_id', userId)
    .eq('is_agent', true)
  
  // 3. è®¡ç®—åŠ é€Ÿ
  const referralCount = Math.min(count || 0, AILearningConfig.RELEASE.MAX_REFERRALS)
  const boost = referralCount * AILearningConfig.RELEASE.BOOST_PER_REFERRAL
  
  // 4. æ€»é‡Šæ”¾ç‡ï¼ˆä¸è¶…è¿‡20%ï¼‰
  rate = Math.min(rate + boost, AILearningConfig.RELEASE.MAX_RATE)
  
  return rate
}
```

#### E. è‡ªåŠ¨é‡å¯æ£€æµ‹ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
```typescript
// src/services/MiningService.ts
async checkAndRestart() {
  // 1. ç»Ÿè®¡æ€»é‡Šæ”¾ç§¯åˆ†
  const { data: released } = await supabase
    .rpc('sum_released_points')
  
  // 2. ç»Ÿè®¡æ–°å……å€¼ç§¯åˆ†
  const { data: exchanged } = await supabase
    .rpc('sum_exchanged_points')
  
  // 3. åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å¯
  if (released > exchanged) {
    console.log('âš ï¸ æ£€æµ‹åˆ°æ³¡æ²«è¿‡å¤§ï¼Œè§¦å‘è‡ªåŠ¨é‡å¯')
    await this.systemRestart()
  }
}

async systemRestart() {
  // 1. æ¸…ç©ºæ‰€æœ‰å­¦ä¹ å¡ç§¯åˆ†
  await supabase
    .from('mining_machines')
    .update({
      total_released: 0,
      status: 'restarted'
    })
    .eq('status', 'active')
  
  // 2. è®°å½•é‡å¯æ—¥å¿—
  await supabase.from('system_logs').insert({
    event: 'auto_restart',
    reason: 'prevent_bubble',
    timestamp: new Date().toISOString()
  })
  
  console.log('âœ… ç³»ç»Ÿé‡å¯å®Œæˆï¼Œæ‰€æœ‰ç§¯åˆ†å·²æ¸…0')
}
```

### 4. å‰ç«¯é¡µé¢ï¼ˆå¾…ä¿®æ”¹ï¼‰

#### A. ç­¾åˆ°æŒ‰é’®
```vue
<template>
  <div class="checkin-section">
    <button 
      @click="handleCheckin" 
      :disabled="isCheckedInToday"
      class="btn btn-primary"
    >
      {{ isCheckedInToday ? 'âœ… ä»Šæ—¥å·²ç­¾åˆ°' : 'ğŸ“… ç­¾åˆ°å¯åŠ¨' }}
    </button>
    
    <div v-if="!isCheckedInToday" class="warning">
      âš ï¸ æœªç­¾åˆ°ï¼Œä»Šæ—¥ä¸é‡Šæ”¾ç§¯åˆ†
    </div>
  </div>
</template>
```

#### B. å…‘æ¢å­¦ä¹ å¡
```vue
<template>
  <div class="exchange-section">
    <h3>ğŸ’³ å…‘æ¢å­¦ä¹ å¡</h3>
    <p>7U = 100ç§¯åˆ†</p>
    
    <input v-model="quantity" type="number" min="1" max="10" />
    
    <button @click="exchangeCard">
      å…‘æ¢ {{ quantity }} å¼ ï¼ˆæ¶ˆè€— {{ quantity * 7 }}Uï¼‰
    </button>
  </div>
</template>
```

---

## ğŸ“Š ç”¨æˆ·ä½¿ç”¨æµç¨‹

```
ç¬¬1æ­¥ï¼šåŠ å…¥Binaryç³»ç»Ÿï¼ˆ30Uï¼‰
  â†“ è‡ªåŠ¨é€100ç§¯åˆ†
ç¬¬2æ­¥ï¼šè‡ªåŠ¨æ¿€æ´»ç¬¬1å¼ å­¦ä¹ å¡ï¼ˆå…è´¹ï¼‰
  â†“
ç¬¬3æ­¥ï¼šæ¯å¤©ç­¾åˆ°å¯åŠ¨
  â†“ é‡Šæ”¾ç§¯åˆ†ï¼ˆ2%-20%ï¼‰
  â”œâ”€ 70% â†’ Uä½™é¢
  â””â”€ 30% â†’ é”€æ¯
  â†“
ç¬¬4æ­¥ï¼š10å€å‡ºå±€ï¼ˆ500å¤© or 50å¤©ï¼‰
  â†“
ç¬¬5æ­¥ï¼šç»§ç»­å…‘æ¢ï¼ˆ7U=100ç§¯åˆ†ï¼‰
  â†“
å¾ªç¯ç¬¬3-5æ­¥
```

---

## âš ï¸ å¾…å®Œæˆå·¥ä½œ

### é«˜ä¼˜å…ˆçº§
- [ ] ä¿®æ”¹ `BinaryService.joinBinary()` - è‡ªåŠ¨é€100ç§¯åˆ†
- [ ] ä¿®æ”¹ `MiningService.purchaseMachine()` - æ”¯æŒUä½™é¢å…‘æ¢
- [ ] æ–°å¢ `MiningService.checkin()` - ç­¾åˆ°é‡Šæ”¾åŠŸèƒ½
- [ ] ä¿®æ”¹ `MiningService.releaseDaily()` - 30%é”€æ¯é€»è¾‘
- [ ] æ–°å¢ `MiningService.calculateReleaseRate()` - ç›´æ¨åŠ é€Ÿ
- [ ] æ–°å¢ `MiningService.checkAndRestart()` - è‡ªåŠ¨é‡å¯æ£€æµ‹

### ä¸­ä¼˜å…ˆçº§
- [ ] æ•°æ®åº“è¿ç§» - æ·»åŠ ç­¾åˆ°ç›¸å…³å­—æ®µ
- [ ] å‰ç«¯é¡µé¢ - ç­¾åˆ°æŒ‰é’®å’ŒUI
- [ ] å‰ç«¯é¡µé¢ - Uä½™é¢å…‘æ¢å…¥å£
- [ ] å®šæ—¶ä»»åŠ¡ - è‡ªåŠ¨é‡å¯æ£€æµ‹

### ä½ä¼˜å…ˆçº§
- [ ] æ–‡æ¡£æ›´æ–° - ç”¨æˆ·ä½¿ç”¨è¯´æ˜
- [ ] æµ‹è¯•ç”¨ä¾‹ - ç­¾åˆ°é€»è¾‘
- [ ] ç®¡ç†åå° - æ‰‹åŠ¨é‡å¯æŒ‰é’®

---

## ğŸ‰ å‡çº§ä¼˜åŠ¿

1. âœ… **æ›´ç®€å•**ï¼šæˆä¸ºä»£ç†è‡ªåŠ¨é€ï¼Œæ— éœ€å¤æ‚æ“ä½œ
2. âœ… **æ›´çµæ´»**ï¼šUä½™é¢ç›´æ¥å…‘æ¢ï¼Œéšæ—¶è´­ä¹°
3. âœ… **æ›´äº’åŠ¨**ï¼šæ¯æ—¥ç­¾åˆ°ï¼Œå¢åŠ ç”¨æˆ·ç²˜æ€§
4. âœ… **æ›´ç¨³å®š**ï¼š30%é”€æ¯+è‡ªåŠ¨é‡å¯ï¼Œé˜²æ­¢é€šèƒ€
5. âœ… **æ›´æ¿€åŠ±**ï¼šç›´æ¨åŠ é€Ÿæ¢å¤ï¼Œé¼“åŠ±æ¨å¹¿
6. âœ… **æ›´é•¿ä¹…**ï¼š10å€å‡ºå±€ï¼Œå»¶é•¿å‘¨æœŸ

---

**é…ç½®å·²å®Œæˆï¼æ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹æœåŠ¡å±‚ä»£ç å®ç°æ–°é€»è¾‘ã€‚** ğŸš€


# 🚀 空投推送逻辑说明

## 📋 当前推送流程

### 1️⃣ 触发机制
```
AI科技群（ai_push）：
├─ 启动时：立即推送 1 条
└─ 定时推送：每 2 分钟推送 1 条（测试模式）
   └─ 生产模式：每 2 小时推送 1 条
```

### 2️⃣ 数据来源（100%真实数据）
```
pushAirdropMessage()
  ↓
loadAirdropsFromDatabase()
  ↓
从 airdrops 表读取
  ├─ 90% 概率：type = 'web3'
  └─ 10% 概率：type = 'cex'
  ↓
筛选条件：
  ├─ status = 'active'（活跃状态）
  ├─ ai_score >= 7.0（高评分）
  └─ 按 ai_score 降序排列
  ↓
返回最多 20 条
  ↓
随机选择 1 条推送
```

### 3️⃣ 推送内容格式
```
🚀 {title}

💎 预计奖励：{reward_min}-{reward_max} USDT
🎯 AI评分：{ai_score}/10 ⭐⭐⭐⭐⭐
📱 平台：{platform}
📊 难度：{difficulty}

📝 {description}

✅ 参与步骤：
1. {step1}
2. {step2}
3. {step3}
...

🔗 {url}
```

### 4️⃣ 推送后处理
```
1. 保存到 messages 表
2. 更新 airdrops 表：
   ├─ push_count +1
   └─ last_pushed_at = now()
```

---

## 🎯 数据库要求

### ✅ 必须有数据
- **如果 airdrops 表为空**：
  - 控制台显示：`⚠️ 数据库中没有空投数据，请先运行爬虫或手动添加数据`
  - **不会推送任何消息**

### 📊 数据来源
1. **方式A（自动）**：运行爬虫脚本
   ```bash
   npm run crawler
   ```

2. **方式B（手动）**：执行 SQL
   ```
   添加测试空投数据.sql
   ```

---

## 📈 推送频率配置

### 当前配置（测试模式）
- **空投机器人**：每 2 分钟
- **赚钱机器人**：每 1 分钟

### 生产环境建议
```typescript
// 空投机器人（修改这里）
botInterval = setInterval(() => {
  pushAirdropMessage()
}, 2 * 60 * 60 * 1000) // 2小时 = 2 * 60 * 60 * 1000 毫秒

// 赚钱机器人（修改这里）
botInterval = setInterval(() => {
  pushMoneyMessage()
}, 30 * 60 * 1000) // 30分钟 = 30 * 60 * 1000 毫秒
```

---

## 🔧 如何修改推送频率

### 文件位置
`src/views/chat/ChatView.vue`

### 修改代码
```typescript
// 第 1056 行：空投机器人
}, 2 * 60 * 60 * 1000) // 改为 2小时

// 第 1069 行：赚钱机器人  
}, 30 * 60 * 1000) // 改为 30分钟
```

---

## 🎲 概率分配

### Web3 vs 交易所
```
随机数 < 0.9  →  type = 'web3'  (90%)
随机数 >= 0.9 →  type = 'cex'   (10%)
```

### 选择逻辑
```
1. 先过滤出符合条件的空投（最多20条）
2. 从这20条中随机选择1条
3. 确保每次推送都有随机性
```

---

## 📝 数据表字段要求

### airdrops 表必须字段
```sql
- id (uuid)
- title (text)               -- 空投标题
- platform (text)            -- 平台名称
- type (text)                -- 'web3' 或 'cex'
- ai_score (numeric)         -- AI评分（0-10）
- reward_min (numeric)       -- 最低奖励
- reward_max (numeric)       -- 最高奖励
- difficulty (text)          -- 'easy', 'medium', 'hard'
- status (text)              -- 'active', 'expired', etc.
- description (text)         -- 项目描述
- steps (text[])             -- 参与步骤数组
- url (text)                 -- 项目链接
- push_count (integer)       -- 推送次数（自动更新）
- last_pushed_at (timestamp) -- 最后推送时间（自动更新）
```

---

## ✅ 优势

1. **100% 真实数据**：不再有硬编码的假数据
2. **灵活管理**：可以随时在数据库中添加/编辑/删除空投
3. **AI评分**：自动优先推送高分空投
4. **90/10 分配**：Web3空投为主，交易所空投为辅
5. **统计追踪**：记录每个空投的推送次数和时间

---

## 🚀 快速启动

### Step 1: 添加测试数据
```sql
-- 在 Supabase SQL Editor 中执行
-- 文件：添加测试空投数据.sql
```

### Step 2: 访问页面
```
打开 AI科技群
自动推送开始！
```

### Step 3: 验证推送
```
✅ 立即推送 1 条
✅ 2分钟后推送下一条
✅ 控制台无错误日志
```

---

## 🎯 下一步

1. ✅ 已完成：去除备用数据
2. ⏳ 待执行：添加测试数据到数据库
3. ⏳ 待部署：运行爬虫脚本（自动化）
4. ⏳ 待调整：修改为生产环境推送频率

---

**现在推送逻辑：100% 真实数据，90% Web3，10% 交易所！** 🎯


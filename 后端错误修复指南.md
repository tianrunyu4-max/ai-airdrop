# åç«¯é”™è¯¯ä¿®å¤æŒ‡å—

## ğŸ” **é—®é¢˜åˆ†æ**

ä»æ§åˆ¶å°é”™è¯¯çœ‹åˆ°ï¼š

```
âŒ "Could not find the table 'public.checkin_records'"
âŒ "Could not find the table 'public.recharge_records'"
âŒ "column withdrawals.created_at does not exist"
âŒ "GET system_config?select=platform_contacts 400"
```

**åŸå› ï¼š** æ•°æ®åº“æœ‰4ä¸ªé—®é¢˜ï¼š
1. `checkin_records` - ç­¾åˆ°è®°å½•è¡¨ä¸å­˜åœ¨
2. `recharge_records` - å……å€¼è®°å½•è¡¨ä¸å­˜åœ¨
3. `withdrawals.created_at` - æç°è¡¨ç¼ºå°‘åˆ›å»ºæ—¶é—´å­—æ®µ
4. `platform_contacts` - å¹³å°è”ç³»æ–¹å¼é…ç½®ç¼ºå¤±

---

## âœ… **è§£å†³æ–¹æ¡ˆï¼ˆ3æ­¥ï¼‰**

### **æ­¥éª¤1ï¼šç™»å½•Supabase**

1. æ‰“å¼€ https://supabase.com
2. ç™»å½•ä½ çš„è´¦å·
3. é€‰æ‹©é¡¹ç›®ï¼š`AIæ™ºèƒ½ç©ºæŠ•`

---

### **æ­¥éª¤2ï¼šæ‰“å¼€SQL Editor**

1. ç‚¹å‡»å·¦ä¾§èœå• **SQL Editor**
2. ç‚¹å‡» **New query**

---

### **æ­¥éª¤3ï¼šæ‰§è¡Œä¿®å¤SQL**

å¤åˆ¶ä¸‹é¢çš„å®Œæ•´SQLï¼Œç²˜è´´åˆ°SQLç¼–è¾‘å™¨ï¼Œç„¶åç‚¹å‡» **Run**ï¼š

```sql
-- ==========================================
-- ä¿®å¤ç¼ºå¤±çš„æ•°æ®åº“è¡¨
-- ==========================================

-- 1. åˆ›å»ºç­¾åˆ°è®°å½•è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
CREATE TABLE IF NOT EXISTS public.checkin_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  machine_id UUID,
  checkin_date DATE NOT NULL,
  points_released DECIMAL(10, 2) DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, checkin_date)
);

-- 2. åˆ›å»ºå……å€¼è®°å½•è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
CREATE TABLE IF NOT EXISTS public.recharge_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  amount DECIMAL(10, 2) NOT NULL,
  currency VARCHAR(10) DEFAULT 'USDT',
  network VARCHAR(20) NOT NULL,
  txid TEXT,
  status VARCHAR(20) DEFAULT 'pending',
  proof_image TEXT,
  admin_note TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  confirmed_at TIMESTAMPTZ,
  confirmed_by UUID REFERENCES auth.users(id)
);

-- 3. å¯ç”¨RLS
ALTER TABLE public.checkin_records ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.recharge_records ENABLE ROW LEVEL SECURITY;

-- 4. åˆ›å»ºRLSç­–ç•¥ - checkin_records
DROP POLICY IF EXISTS "ç”¨æˆ·å¯æŸ¥çœ‹è‡ªå·±çš„ç­¾åˆ°è®°å½•" ON public.checkin_records;
CREATE POLICY "ç”¨æˆ·å¯æŸ¥çœ‹è‡ªå·±çš„ç­¾åˆ°è®°å½•" ON public.checkin_records
  FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "ç”¨æˆ·å¯åˆ›å»ºè‡ªå·±çš„ç­¾åˆ°è®°å½•" ON public.checkin_records;
CREATE POLICY "ç”¨æˆ·å¯åˆ›å»ºè‡ªå·±çš„ç­¾åˆ°è®°å½•" ON public.checkin_records
  FOR INSERT WITH CHECK (auth.uid() = user_id);

-- 5. åˆ›å»ºRLSç­–ç•¥ - recharge_records
DROP POLICY IF EXISTS "ç”¨æˆ·å¯æŸ¥çœ‹è‡ªå·±çš„å……å€¼è®°å½•" ON public.recharge_records;
CREATE POLICY "ç”¨æˆ·å¯æŸ¥çœ‹è‡ªå·±çš„å……å€¼è®°å½•" ON public.recharge_records
  FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "ç”¨æˆ·å¯åˆ›å»ºå……å€¼è®°å½•" ON public.recharge_records;
CREATE POLICY "ç”¨æˆ·å¯åˆ›å»ºå……å€¼è®°å½•" ON public.recharge_records
  FOR INSERT WITH CHECK (auth.uid() = user_id);

DROP POLICY IF EXISTS "ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰å……å€¼è®°å½•" ON public.recharge_records;
CREATE POLICY "ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰å……å€¼è®°å½•" ON public.recharge_records
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM public.users
      WHERE users.id = auth.uid()
      AND users.is_admin = true
    )
  );

DROP POLICY IF EXISTS "ç®¡ç†å‘˜å¯æ›´æ–°å……å€¼è®°å½•" ON public.recharge_records;
CREATE POLICY "ç®¡ç†å‘˜å¯æ›´æ–°å……å€¼è®°å½•" ON public.recharge_records
  FOR UPDATE USING (
    EXISTS (
      SELECT 1 FROM public.users
      WHERE users.id = auth.uid()
      AND users.is_admin = true
    )
  );

-- 6. åˆ›å»ºç´¢å¼•ï¼ˆæé«˜æŸ¥è¯¢æ€§èƒ½ï¼‰
CREATE INDEX IF NOT EXISTS idx_checkin_records_user_id ON public.checkin_records(user_id);
CREATE INDEX IF NOT EXISTS idx_checkin_records_date ON public.checkin_records(checkin_date);
CREATE INDEX IF NOT EXISTS idx_recharge_records_user_id ON public.recharge_records(user_id);
CREATE INDEX IF NOT EXISTS idx_recharge_records_status ON public.recharge_records(status);
CREATE INDEX IF NOT EXISTS idx_recharge_records_created_at ON public.recharge_records(created_at DESC);

-- 7. éªŒè¯è¡¨å·²åˆ›å»º
SELECT 
  table_name,
  table_type
FROM information_schema.tables
WHERE table_schema = 'public'
  AND table_name IN ('checkin_records', 'recharge_records')
ORDER BY table_name;
```

---

### **æ­¥éª¤4ï¼šæ‰§è¡Œå……å€¼é…ç½®SQL**

ç»§ç»­æ‰§è¡Œè¿™ä¸ªSQLï¼ˆé…ç½®å……å€¼åœ°å€ï¼‰ï¼š

```sql
-- é…ç½®å……å€¼ç³»ç»Ÿ
INSERT INTO system_config (key, value, description)
VALUES (
  'recharge_config',
  jsonb_build_object(
    'usdt_trc20', 'TQTjfehUeHRWkw7QkcRKojWYdzYPebr9iS',
    'usdt_bep20', '0xc8288b98f7c2cc11bccbc033754effcc87c1909e',
    'enable_recharge', true,
    'min_amount', 30,
    'notice', 'ğŸ’¡ å……å€¼è¯´æ˜ï¼š\n1. è®¤çœŸæ ¸å¯¹å……å€¼åœ°å€\n2. 30Uèµ·æ­¥\n3. AIè‡ªåŠ¨å®¡æ ¸ ç¨ç­‰ç‰‡åˆ»'
  ),
  'å……å€¼ç³»ç»Ÿé…ç½®ï¼ˆTRC20æ³¢åœºé“¾ + BEP20å¸å®‰æ™ºèƒ½é“¾ï¼‰'
)
ON CONFLICT (key) DO UPDATE
SET 
  value = jsonb_build_object(
    'usdt_trc20', 'TQTjfehUeHRWkw7QkcRKojWYdzYPebr9iS',
    'usdt_bep20', '0xc8288b98f7c2cc11bccbc033754effcc87c1909e',
    'enable_recharge', true,
    'min_amount', 30,
    'notice', 'ğŸ’¡ å……å€¼è¯´æ˜ï¼š\n1. è®¤çœŸæ ¸å¯¹å……å€¼åœ°å€\n2. 30Uèµ·æ­¥\n3. AIè‡ªåŠ¨å®¡æ ¸ ç¨ç­‰ç‰‡åˆ»'
  ),
  updated_at = NOW();
```

---

## ğŸ” **éªŒè¯ä¿®å¤**

æ‰§è¡Œå®Œæˆåï¼Œåº”è¯¥çœ‹åˆ°æŸ¥è¯¢ç»“æœï¼š

```
table_name          | table_type
--------------------|-------------
checkin_records     | BASE TABLE
recharge_records    | BASE TABLE
```

---

## ğŸ¯ **åˆ·æ–°é¡µé¢æµ‹è¯•**

1. å…³é—­æµè§ˆå™¨çš„**å¼€å‘è€…å·¥å…·**ï¼ˆF12ï¼‰
2. åˆ·æ–°é¡µé¢ï¼ˆCtrl + F5 å¼ºåˆ¶åˆ·æ–°ï¼‰
3. å†æ¬¡æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
4. æŸ¥çœ‹æ§åˆ¶å°ï¼Œ**åº”è¯¥æ²¡æœ‰é”™è¯¯äº†** âœ…

---

## ğŸ“‹ **åŠŸèƒ½æµ‹è¯•æ¸…å•**

æ‰§è¡ŒSQLåï¼Œæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

### **å……å€¼åŠŸèƒ½ï¼š**
- [ ] æ‰“å¼€"æˆ‘çš„" â†’ ç‚¹å‡»"ğŸ’° å……å€¼"
- [ ] é€‰æ‹©TRC20ï¼Œåº”è¯¥æ˜¾ç¤ºåœ°å€ï¼š`TQTjfehUeHRWkw7QkcRKojWYdzYPebr9iS`
- [ ] é€‰æ‹©BEP20ï¼Œåº”è¯¥æ˜¾ç¤ºåœ°å€ï¼š`0xc8288b98f7c2cc11bccbc033754effcc87c1909e`
- [ ] æŸ¥çœ‹æç¤ºï¼š"è®¤çœŸæ ¸å¯¹å……å€¼åœ°å€ / 30Uèµ·æ­¥ / AIè‡ªåŠ¨å®¡æ ¸ ç¨ç­‰ç‰‡åˆ»"

### **å­¦ä¹ å¡ç­¾åˆ°ï¼š**
- [ ] æ‰“å¼€"ç§¯åˆ†"é¡µé¢
- [ ] å¦‚æœæœ‰å­¦ä¹ å¡ï¼Œç‚¹å‡»"ç­¾åˆ°"
- [ ] åº”è¯¥æˆåŠŸç­¾åˆ°ï¼Œä¸å†æŠ¥é”™

### **ç®¡ç†åå°ï¼š**
- [ ] æ‰“å¼€"å……å€¼ç®¡ç†"
- [ ] åº”è¯¥èƒ½çœ‹åˆ°å……å€¼è®°å½•åˆ—è¡¨ï¼ˆå³ä½¿æ˜¯ç©ºçš„ï¼‰

---

## âš ï¸ **å¸¸è§é—®é¢˜**

### **Q1: æ‰§è¡ŒSQLæ—¶æŠ¥é”™ "already exists"**
**A:** å¿½ç•¥å³å¯ï¼Œè¯´æ˜è¡¨å·²ç»å­˜åœ¨äº†ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚

### **Q2: æ‰§è¡Œåè¿˜æ˜¯æŠ¥é”™**
**A:** 
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl + Shift + Deleteï¼‰
2. å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼ˆCtrl + F5ï¼‰
3. é‡æ–°ç™»å½•

### **Q3: å……å€¼åœ°å€æ²¡æœ‰æ˜¾ç¤º**
**A:** ç¡®ä¿æ‰§è¡Œäº†"å……å€¼é…ç½®SQL"ï¼ˆæ­¥éª¤4ï¼‰

---

## ğŸ“Š **é”™è¯¯å¯¹ç…§è¡¨**

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `Could not find the table 'public.checkin_records'` | ç­¾åˆ°è®°å½•è¡¨ä¸å­˜åœ¨ | æ‰§è¡Œä¿®å¤SQL âœ… |
| `Could not find the table 'public.recharge_records'` | å……å€¼è®°å½•è¡¨ä¸å­˜åœ¨ | æ‰§è¡Œä¿®å¤SQL âœ… |
| `404 (Not Found)` | è¡¨æˆ–é…ç½®ä¸å­˜åœ¨ | æ‰§è¡Œä¸¤ä¸ªSQL âœ… |
| `400 (Bad Request)` | RLSç­–ç•¥é—®é¢˜ | ä¿®å¤SQLå·²åŒ…å«RLSç­–ç•¥ âœ… |

---

## ğŸš€ **æ‰§è¡Œé¡ºåºæ€»ç»“**

```
1. ç™»å½•Supabase âœ…
   â†“
2. æ‰“å¼€SQL Editor âœ…
   â†“
3. æ‰§è¡Œä¿®å¤SQLï¼ˆåˆ›å»ºè¡¨ï¼‰âœ…
   â†“
4. æ‰§è¡Œå……å€¼é…ç½®SQL âœ…
   â†“
5. åˆ·æ–°é¡µé¢éªŒè¯ âœ…
```

---

**ä¿®å¤æ—¶é—´ï¼š** çº¦3-5åˆ†é’Ÿ  
**æ‰§è¡Œåæ•ˆæœï¼š** æ‰€æœ‰æ§åˆ¶å°é”™è¯¯æ¶ˆå¤±ï¼ŒåŠŸèƒ½æ­£å¸¸ âœ…



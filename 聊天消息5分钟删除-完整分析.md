# ğŸ” èŠå¤©æ¶ˆæ¯é—®é¢˜å®Œæ•´åˆ†æ

## é—®é¢˜ç°è±¡
ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œæ¶ˆæ¯ç¬é—´æ¶ˆå¤±

## æ ¹æœ¬åŸå› åˆ†æ

### 1. æ¶ˆæ¯è¿‡æ»¤é“¾è·¯
```
å‘é€æ¶ˆæ¯ â†’ messages.value
    â†“
validMessages (computed) 
    â†“ (è¿‡æ»¤é€»è¾‘)
æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
```

### 2. è¿‡æ»¤æ¡ä»¶ï¼ˆå½“å‰ä»£ç ï¼‰
```typescript
if (msg.is_bot) {
  // æœºå™¨äººæ¶ˆæ¯ï¼šæ ¹æ®æ—¶é—´
  return age <= botCleanupTime
} else {
  // ç”¨æˆ·æ¶ˆæ¯ï¼š5åˆ†é’Ÿ
  return age <= USER_MESSAGE_CLEANUP_TIME
}
```

### 3. é—®é¢˜ç‚¹
- âœ… é€»è¾‘çœ‹èµ·æ¥æ­£ç¡®
- âŒ ä½†æ˜¯å¯èƒ½æœ‰å…¶ä»–åœ°æ–¹åœ¨è¿‡æ»¤æ¶ˆæ¯
- âŒ localStorage å¯èƒ½åŠ è½½äº†æ—§æ¶ˆæ¯
- âŒ å®šæ—¶æ¸…ç†å¯èƒ½å¤ªé¢‘ç¹

## å½»åº•è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç®€åŒ–æ¶ˆæ¯è¿‡æ»¤ï¼ˆæ¨èï¼‰
```typescript
// ä¸åœ¨ validMessages ä¸­è¿‡æ»¤æ—¶é—´
// åªåœ¨å®šæ—¶å™¨ä¸­è¿‡æ»¤
const validMessages = computed(() => {
  return messages.value // ç›´æ¥è¿”å›æ‰€æœ‰æ¶ˆæ¯
})

// å®šæ—¶æ¸…ç†
setInterval(() => {
  const now = Date.now()
  messages.value = messages.value.filter(msg => {
    const age = now - new Date(msg.created_at).getTime()
    if (msg.is_bot) {
      return age <= botCleanupTime
    } else {
      return age <= 5 * 60 * 1000 // 5åˆ†é’Ÿ
    }
  })
}, 30000)
```

### æ–¹æ¡ˆ2ï¼šç¦ç”¨localStorageç¼“å­˜
```typescript
// ä¸ç¼“å­˜æ¶ˆæ¯åˆ°localStorage
// åªä»Supabaseè¯»å–
```

### æ–¹æ¡ˆ3ï¼šå¢åŠ è°ƒè¯•æ—¥å¿—
```typescript
const validMessages = computed(() => {
  const filtered = messages.value.filter(msg => {
    const age = now - messageTime
    console.log(`æ¶ˆæ¯: ${msg.username}, å¹´é¾„: ${age/1000}ç§’, ä¿ç•™: ${shouldKeep}`)
    return shouldKeep
  })
  console.log(`æ€»æ¶ˆæ¯: ${messages.value.length}, è¿‡æ»¤å: ${filtered.length}`)
  return filtered
})
```

## ç«‹å³å®æ–½æ­¥éª¤

1. **ç®€åŒ–validMessages** - ç§»é™¤æ‰€æœ‰è¿‡æ»¤é€»è¾‘
2. **ç¦ç”¨localStorage** - é¿å…åŠ è½½æ—§æ¶ˆæ¯
3. **åªåœ¨å®šæ—¶å™¨ä¸­æ¸…ç†** - 30ç§’æ£€æŸ¥ä¸€æ¬¡
4. **å¢åŠ æ—¥å¿—** - ä¾¿äºè°ƒè¯•

## æµ‹è¯•éªŒè¯

1. å‘é€æ¶ˆæ¯ â†’ ç«‹å³æ˜¾ç¤º âœ…
2. ç­‰å¾…30ç§’ â†’ æ¶ˆæ¯è¿˜åœ¨ âœ…
3. ç­‰å¾…5åˆ†é’Ÿ â†’ æ¶ˆæ¯æ¶ˆå¤± âœ…


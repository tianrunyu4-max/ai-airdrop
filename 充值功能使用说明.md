# 💰 充值功能使用说明

## 📋 功能说明

已添加完整的USDT充值功能，支持TRC20和ERC20网络。

---

## 🎯 用户界面

### 位置：**我的** → 余额卡片下方

两个大按钮：
- 💰 **充值** (绿色) 
- 💳 **提现** (黄色)

### 充值流程：

1. 点击"💰 充值"按钮
2. 选择网络（TRC20 或 ERC20）
3. 复制充值地址
4. 输入充值金额
5. 可选：填写交易哈希（加快确认）
6. 提交申请
7. 等待管理员确认

---

## ⚙️ 管理后台配置

### 1. 执行数据库SQL

复制并执行：`supabase/migrations/添加充值配置.sql`

### 2. 设置充值地址

在 **系统管理** 页面，找到 **system_config** 表，修改 `recharge_config`:

```json
{
  "usdt_trc20": "TXxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "usdt_erc20": "0xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "enable_recharge": true,
  "min_amount": 10,
  "notice": "充值后请联系客服确认到账"
}
```

### 3. 确认充值申请

在 **系统管理** 中会显示所有充值申请（待开发后台管理页面）

暂时可通过数据库直接查看：
```sql
SELECT * FROM recharge_records WHERE status = 'pending';
```

手动确认充值（替换ID）：
```sql
-- 方法1：调用Service
-- 在代码中调用 RechargeService.confirmRecharge(rechargeId)

-- 方法2：直接SQL（临时）
UPDATE recharge_records 
SET status = 'confirmed', 
    confirmed_at = NOW()
WHERE id = '充值记录ID';

-- 增加用户余额
UPDATE users 
SET u_balance = u_balance + 充值金额
WHERE id = '用户ID';
```

---

## 📊 数据表结构

### recharge_records (充值记录)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| user_id | UUID | 用户ID |
| amount | DECIMAL | 充值金额 |
| currency | VARCHAR | 币种(USDT) |
| network | VARCHAR | 网络(TRC20/ERC20) |
| txid | VARCHAR | 交易哈希 |
| status | VARCHAR | 状态(pending/confirmed/rejected) |
| proof_image | TEXT | 凭证截图 |
| admin_note | TEXT | 管理员备注 |
| created_at | TIMESTAMP | 创建时间 |
| confirmed_at | TIMESTAMP | 确认时间 |
| confirmed_by | UUID | 确认人 |

---

## 🚀 下一步优化

1. **添加管理后台充值审核页面**
2. **支持上传转账凭证截图**
3. **自动检测链上交易（TronGrid API）**
4. **邮件/短信通知用户充值到账**
5. **充值记录查询页面**

---

**现在用户可以：**
✅ 选择网络充值
✅ 自动提交申请
✅ 查看充值记录

**管理员可以：**
✅ 配置充值地址
✅ 查看充值申请
✅ 确认充值到账（手动）

---

*创建时间：2025-10-20*


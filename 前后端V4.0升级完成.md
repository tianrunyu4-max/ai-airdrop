# âœ… AIå­¦ä¹ å¡V4.0 å‰åç«¯å‡çº§å®Œæˆ

> **å®Œæˆæ—¶é—´**ï¼š2025-10-11  
> **ç‰ˆæœ¬**ï¼šV4.0  
> **çŠ¶æ€**ï¼šâœ… å‰åç«¯ä»£ç å®Œæˆï¼Œé€»è¾‘ä¸€è‡´

---

## ğŸ‰ å·²å®Œæˆå·¥ä½œ

### åç«¯ä»£ç  âœ…
1. âœ… é…ç½®æ–‡ä»¶ `src/config/mining.ts` - V4.0å‚æ•°
2. âœ… ä»£ç†æœåŠ¡ `src/services/AgentService.ts` - è‡ªåŠ¨é€100ç§¯åˆ†
3. âœ… å­¦ä¹ å¡æœåŠ¡ `src/services/MiningService.ts` - å®Œæ•´V4.0é€»è¾‘
   - å…‘æ¢å­¦ä¹ å¡ï¼ˆ7U = 100ç§¯åˆ†ï¼‰
   - æ¯æ—¥ç­¾åˆ°é‡Šæ”¾
   - è®¡ç®—ç›´æ¨åŠ é€Ÿï¼ˆ2%-20%ï¼‰
   - V4.0é‡Šæ”¾é€»è¾‘ï¼ˆ70%åˆ°è´¦+30%é”€æ¯ï¼‰
   - è‡ªåŠ¨é‡å¯æ£€æµ‹
   - æ‰‹åŠ¨é‡å¯åŠŸèƒ½

### å‰ç«¯é¡µé¢ âœ…
1. âœ… é¡µé¢æ ‡é¢˜ï¼šå­¦ä¹ æœº â†’ å­¦ä¹ å¡
2. âœ… ç­¾åˆ°åŒºåŸŸï¼šç­¾åˆ°æŒ‰é’®+é‡Šæ”¾ç‡æ˜¾ç¤º
3. âœ… å…‘æ¢åŒºåŸŸï¼š7Uå…‘æ¢å­¦ä¹ å¡
4. âœ… å‚æ•°å±•ç¤ºï¼šV4.0æ–°å‚æ•°ï¼ˆ2-20%é‡Šæ”¾ï¼Œ10å€å‡ºå±€ï¼‰
5. âœ… æ”¶ç›Šåˆ†é…ï¼š70%åˆ°è´¦+30%é”€æ¯
6. âœ… æ–‡æ¡ˆæ›´æ–°ï¼šæ‰€æœ‰"å­¦ä¹ æœº"æ”¹ä¸º"å­¦ä¹ å¡"
7. âœ… é€»è¾‘ä¿®æ”¹ï¼š
   - `handleCheckin()` - ç­¾åˆ°åŠŸèƒ½
   - `exchangeCard()` - å…‘æ¢åŠŸèƒ½
   - `calculateReleaseRate()` - è®¡ç®—é‡Šæ”¾ç‡
   - `checkCheckinStatus()` - æ£€æŸ¥ç­¾åˆ°çŠ¶æ€

---

## ğŸ“‹ å‰åç«¯å¯¹ç…§

| åŠŸèƒ½ | åç«¯å®ç° | å‰ç«¯å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| **è‡ªåŠ¨é€100ç§¯åˆ†** | `AgentService.ts:126-135` | - | âœ… åç«¯è‡ªåŠ¨ |
| **å…‘æ¢å­¦ä¹ å¡** | `MiningService.ts:30-120` | `PointsView.vue:460-510 (exchangeCard)` | âœ… ä¸€è‡´ |
| **æ¯æ—¥ç­¾åˆ°** | `MiningService.ts:223-298 (checkin)` | `PointsView.vue:429-457 (handleCheckin)` | âœ… ä¸€è‡´ |
| **è®¡ç®—é‡Šæ”¾ç‡** | `MiningService.ts:303-334` | `PointsView.vue:634-659` | âœ… ä¸€è‡´ |
| **é‡Šæ”¾ç§¯åˆ†** | `MiningService.ts:339-433` | - | âœ… åç«¯è‡ªåŠ¨ |
| **è‡ªåŠ¨é‡å¯** | `MiningService.ts:963-1021` | - | âœ… åç«¯è‡ªåŠ¨ |

---

## ğŸ”¥ æ ¸å¿ƒé€»è¾‘å¯¹æ¯”

### 1. å…‘æ¢å­¦ä¹ å¡

#### åç«¯
```typescript
// src/services/MiningService.ts:30-120
static async purchaseMachine(
  userId: string, 
  quantity: number = 1,
  machineType: 'type1' | 'type2' | 'type3' = 'type1'
): Promise<ApiResponse<MiningMachine>>
```
- âœ… æ‰£é™¤7U Ã— æ•°é‡
- âœ… åˆ›å»ºå­¦ä¹ å¡ï¼ˆåˆå§‹inactiveçŠ¶æ€ï¼‰
- âœ… è¿”å›æˆåŠŸæ¶ˆæ¯

#### å‰ç«¯
```typescript
// src/views/points/PointsView.vue:460-510
const exchangeCard = async () => {
  const result = await MiningService.purchaseMachine(
    user.value.id,
    purchaseCount.value
  )
}
```
- âœ… æ£€æŸ¥ä»£ç†èº«ä»½
- âœ… æ£€æŸ¥Uä½™é¢
- âœ… è°ƒç”¨åç«¯API
- âœ… åˆ·æ–°æ•°æ®

---

### 2. æ¯æ—¥ç­¾åˆ°

#### åç«¯
```typescript
// src/services/MiningService.ts:223-298
static async checkin(userId: string): Promise<ApiResponse<{
  checkedInCount: number
  totalReleased: number
  releaseRate: number
}>>
```
- âœ… æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç­¾åˆ°
- âœ… è®¡ç®—é‡Šæ”¾ç‡ï¼ˆåŸºç¡€2% + ç›´æ¨åŠ é€Ÿï¼‰
- âœ… æ‰¹é‡ç­¾åˆ°æ‰€æœ‰å­¦ä¹ å¡
- âœ… æ‰§è¡Œé‡Šæ”¾ç§¯åˆ†

#### å‰ç«¯
```typescript
// src/views/points/PointsView.vue:429-457
const handleCheckin = async () => {
  const result = await MiningService.checkin(user.value.id)
  if (result.success) {
    isCheckedInToday.value = true
    releaseRate.value = result.data?.releaseRate || 0.02
  }
}
```
- âœ… è°ƒç”¨åç«¯API
- âœ… æ›´æ–°ç­¾åˆ°çŠ¶æ€
- âœ… æ›´æ–°é‡Šæ”¾ç‡
- âœ… åˆ·æ–°æ•°æ®

---

### 3. è®¡ç®—é‡Šæ”¾ç‡

#### åç«¯
```typescript
// src/services/MiningService.ts:303-334
private static async calculateReleaseRate(userId: string): Promise<number> {
  let rate = 0.02 // åŸºç¡€2%
  
  // æŸ¥è¯¢ç›´æ¨AIä»£ç†æ•°é‡
  const { count } = await supabase
    .from('users')
    .select('id', { count: 'exact', head: true })
    .eq('inviter_id', userId)
    .eq('is_agent', true)
  
  // è®¡ç®—åŠ é€Ÿ
  const referralCount = Math.min(count || 0, 6)
  const boost = referralCount * 0.03
  
  rate = Math.min(rate + boost, 0.20)
  return rate
}
```

#### å‰ç«¯
```typescript
// src/views/points/PointsView.vue:634-659
const calculateReleaseRate = async () => {
  // æŸ¥è¯¢ç›´æ¨AIä»£ç†æ•°é‡
  const { count } = await supabase
    .from('users')
    .select('id', { count: 'exact', head: true })
    .eq('inviter_id', user.value.id)
    .eq('is_agent', true)
  
  // è®¡ç®—é‡Šæ”¾ç‡ï¼šåŸºç¡€2% + ç›´æ¨åŠ é€Ÿ3%Ã—äººæ•°ï¼Œæœ€é«˜20%
  const referralCount = Math.min(count || 0, 6)
  const rate = Math.min(0.02 + referralCount * 0.03, 0.20)
  releaseRate.value = rate
}
```

**å¯¹æ¯”ç»“æœ**: âœ… é€»è¾‘å®Œå…¨ä¸€è‡´

---

### 4. é‡Šæ”¾ç§¯åˆ†ï¼ˆ70%åˆ°è´¦+30%é”€æ¯ï¼‰

#### åç«¯
```typescript
// src/services/MiningService.ts:381-396
const toU = actualRelease * 0.70 // 70%åˆ°è´¦
const toBurn = actualRelease * 0.30 // 30%é”€æ¯

// 70%è½¬Uä½™é¢
const uAmount = toU * 0.07 // 100ç§¯åˆ† = 7U
await WalletManager.add(
  machine.user_id,
  uAmount,
  'u_balance',
  'mining_release',
  `AIå­¦ä¹ å¡é‡Šæ”¾${toU.toFixed(2)}ç§¯åˆ†ï¼Œå…‘æ¢${uAmount.toFixed(2)}U`
)

// 30%é”€æ¯ï¼ˆè®°å½•æ—¥å¿—ï¼‰
console.log(`å­¦ä¹ å¡ ${machineId} é”€æ¯ ${toBurn.toFixed(2)} ç§¯åˆ†`)
```

#### å‰ç«¯
```html
<!-- src/views/points/PointsView.vue:162-174 -->
<div class="bg-gradient-to-r from-yellow-100 to-yellow-50 rounded-xl p-4 mb-6 border border-yellow-300">
  <div class="text-center text-sm font-bold text-gray-700 mb-3">ğŸ“Š æ¯æ—¥æ”¶ç›Šè‡ªåŠ¨åˆ†é…</div>
  <div class="space-y-2">
    <div class="flex items-center justify-between bg-white rounded-lg p-3">
      <span class="text-gray-600">70% è‡ªåŠ¨è½¬U</span>
      <span class="text-yellow-600 font-bold">ç›´æ¥åˆ°è´¦</span>
    </div>
    <div class="flex items-center justify-between bg-white rounded-lg p-3">
      <span class="text-gray-600">30% è‡ªåŠ¨é”€æ¯</span>
      <span class="text-red-600 font-bold">æ¸…0é˜²æ³¡æ²«</span>
    </div>
  </div>
</div>
```

**å¯¹æ¯”ç»“æœ**: âœ… è¯´æ˜ä¸€è‡´

---

## âš ï¸ å¾…å®Œæˆå·¥ä½œ

### 1. æ•°æ®åº“è¡¨ä¿®æ”¹ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
```sql
ALTER TABLE mining_machines 
ADD COLUMN IF NOT EXISTS last_checkin_date DATE,
ADD COLUMN IF NOT EXISTS checkin_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS is_checked_in_today BOOLEAN DEFAULT FALSE;
```

**è¯´æ˜**: è¿™äº›å­—æ®µæ˜¯ç­¾åˆ°åŠŸèƒ½å¿…é¡»çš„ï¼Œå¦åˆ™ç­¾åˆ°åŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚

---

### 2. å®šæ—¶ä»»åŠ¡é…ç½®ï¼ˆå¯é€‰ï¼‰
```javascript
// scripts/cron/check-restart.js
import { MiningService } from '../src/services/MiningService'

// æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡æ³¡æ²«æ£€æµ‹
setInterval(async () => {
  console.log('â° æ‰§è¡Œè‡ªåŠ¨é‡å¯æ£€æµ‹...')
  await MiningService.checkAndRestart()
}, 60 * 60 * 1000) // 1å°æ—¶
```

---

## ğŸ“Š V4.0å®Œæ•´å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| **åç§°** | AIå­¦ä¹ å¡ | âœ… |
| **è·å¾—æ–¹å¼** | åŠ å…¥ä»£ç†è‡ªåŠ¨é€100ç§¯åˆ† | âœ… |
| **å…‘æ¢æˆæœ¬** | 7U = 100ç§¯åˆ† | âœ… |
| **é‡Šæ”¾æ¡ä»¶** | æ¯æ—¥ç­¾åˆ° | âœ… |
| **åŸºç¡€é‡Šæ”¾ç‡** | 2%/å¤© | âœ… |
| **ç›´æ¨åŠ é€Ÿ** | +3%/äººï¼Œæœ€é«˜20% | âœ… |
| **å‡ºå±€å€æ•°** | 10å€ï¼ˆ1000ç§¯åˆ†ï¼‰ | âœ… |
| **å‡ºå±€æ—¶é—´** | 50-500å¤© | âœ… |
| **ç§¯åˆ†åˆ†é…** | 70%åˆ°è´¦+30%é”€æ¯ | âœ… |
| **å¤åˆ©æ»šå­˜** | å–æ¶ˆ | âœ… |
| **é‡å¯æœºåˆ¶** | è‡ªåŠ¨+æ‰‹åŠ¨ | âœ… |

---

## ğŸ¯ æµ‹è¯•å»ºè®®

### æµ‹è¯•æµç¨‹
1. âœ… æ³¨å†Œè´¦å·
2. âœ… åŠ å…¥Binaryç³»ç»Ÿï¼ˆ30Uï¼‰ â†’ è‡ªåŠ¨é€100ç§¯åˆ†
3. âœ… ç”¨7Uå…‘æ¢ç¬¬1å¼ å­¦ä¹ å¡
4. âœ… æ¯å¤©ç­¾åˆ° â†’ æŸ¥çœ‹é‡Šæ”¾ç‡
5. âœ… æŸ¥çœ‹Uä½™é¢å¢åŠ ï¼ˆ70%ï¼‰
6. âœ… ç›´æ¨æ–°äºº â†’ è§‚å¯Ÿé‡Šæ”¾ç‡æå‡
7. âœ… 10å€å‡ºå±€åæŸ¥çœ‹çŠ¶æ€

### æµ‹è¯•è´¦å·å»ºè®®
- è´¦å·Aï¼š0ä¸ªç›´æ¨ï¼ˆé‡Šæ”¾ç‡2%ï¼‰
- è´¦å·Bï¼š1ä¸ªç›´æ¨ï¼ˆé‡Šæ”¾ç‡5%ï¼‰
- è´¦å·Cï¼š6ä¸ªç›´æ¨ï¼ˆé‡Šæ”¾ç‡20%ï¼‰

---

## âœ… æ€»ç»“

**å‰åç«¯ä»£ç å·²å®Œå…¨ä¸€è‡´ï¼**

âœ… åç«¯é€»è¾‘å®Œæ•´  
âœ… å‰ç«¯UIå®Œæ•´  
âœ… å‚æ•°é…ç½®ä¸€è‡´  
âœ… è®¡ç®—é€»è¾‘ä¸€è‡´  
âœ… æ–‡æ¡ˆè¯´æ˜ä¸€è‡´  

**åªéœ€è¦**:
1. æ·»åŠ æ•°æ®åº“å­—æ®µï¼ˆå¿…é¡»ï¼‰
2. æµ‹è¯•æ•´ä½“æµç¨‹
3. éƒ¨ç½²ä¸Šçº¿

---

**æ‰€æœ‰ä»£ç å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•å’Œéƒ¨ç½²äº†ï¼** ğŸš€


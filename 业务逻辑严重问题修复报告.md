# ğŸš¨ ä¸šåŠ¡é€»è¾‘ä¸¥é‡é—®é¢˜ä¿®å¤æŠ¥å‘Š

**é—®é¢˜å‘ç°æ—¶é—´**ï¼š2025-10-26  
**ä¸¥é‡ç¨‹åº¦**ï¼šâš ï¸ **ä¸¥é‡** - å½±å“æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

---

## âŒ å‘ç°çš„é—®é¢˜

### é—®é¢˜1ï¼šå›¢é˜Ÿæ˜¾ç¤ºé”™è¯¯
**ç°è±¡**ï¼šç”¨æˆ·åªå‡çº§äº†1ä¸ªAIä»£ç†ï¼Œä½†å›¢é˜Ÿæ˜¾ç¤º3äºº

**åŸå› **ï¼š
- `referral_relationships` è¡¨ä¸­å¯èƒ½åŒ…å«äº†éAIä»£ç†çš„è®°å½•
- ç›´æ¨åˆ—è¡¨æŸ¥è¯¢æ²¡æœ‰è¿‡æ»¤ `is_agent = true`

**ä»£ç ä½ç½®**ï¼š`src/views/team/TeamView.vue` ç¬¬374-395è¡Œ

```typescript
// âŒ é”™è¯¯ï¼šæ²¡æœ‰è¿‡æ»¤ is_agent
const { data, error } = await supabase
  .from('referral_relationships')
  .select(`
    created_at,
    users!referee_id (
      id,
      username,
      network_side,
      created_at,
      is_agent
    )
  `)
  .eq('referrer_id', userId)
  .eq('is_active', true)
  // âŒ ç¼ºå°‘ï¼š.eq('users.is_agent', true)
```

---

### é—®é¢˜2ï¼š100ç§¯åˆ†å˜æˆç§¯åˆ†å¡
**ç°è±¡**ï¼šå‡çº§AIä»£ç†åï¼Œç³»ç»Ÿé€çš„100ç§¯åˆ†å˜æˆäº†ç§¯åˆ†å¡

**å¯èƒ½åŸå› **ï¼š
1. **å‰ç«¯æ˜¾ç¤ºé€»è¾‘æ··ä¹±** - ç§¯åˆ†å’Œç§¯åˆ†å¡æ˜¾ç¤ºåœ¨ä¸€èµ·
2. **æ•°æ®åº“ä¸­æœ‰æ—§æ•°æ®** - ä¹‹å‰æµ‹è¯•ç•™ä¸‹çš„å­¦ä¹ å¡
3. **localStorageç¼“å­˜é—®é¢˜** - ç¼“å­˜äº†é”™è¯¯çš„æ•°æ®

**ä»£ç ä½ç½®**ï¼š`src/views/points/PointsView.vue`

---

### é—®é¢˜3ï¼šç§¯åˆ†å¡æœ‰7å¼ ï¼ˆä¸æ­£å¸¸ï¼‰
**ç°è±¡**ï¼šæ–°ç”¨æˆ·æœ‰7å¼ ç§¯åˆ†å¡

**å¯èƒ½åŸå› **ï¼š
1. **æµ‹è¯•æ•°æ®æœªæ¸…ç†** - localStorage ä¸­æœ‰æ—§çš„å­¦ä¹ å¡æ•°æ®
2. **é‡å¤åˆ›å»º** - å¯èƒ½è§¦å‘äº†å¤šæ¬¡åˆ›å»ºé€»è¾‘

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šå›¢é˜Ÿåˆ—è¡¨è¿‡æ»¤éAIä»£ç†

**æ–‡ä»¶**ï¼š`src/views/team/TeamView.vue` ç¬¬398-405è¡Œ

**ä¿®å¤å‰**ï¼š
```typescript
referralList.value = (data || []).map(item => ({
  id: item.users.id,
  username: item.users.username,
  network_side: item.users.network_side,
  created_at: item.created_at,
  is_agent: item.users.is_agent
}))
```

**ä¿®å¤å**ï¼š
```typescript
// âœ… åªæ˜¾ç¤ºAIä»£ç†
referralList.value = (data || [])
  .filter(item => item.users.is_agent === true)  // âœ… è¿‡æ»¤éAIä»£ç†
  .map(item => ({
    id: item.users.id,
    username: item.users.username,
    network_side: item.users.network_side,
    created_at: item.created_at,
    is_agent: item.users.is_agent
  }))
```

---

### ä¿®å¤2ï¼šæ¸…ç† localStorage ç¼“å­˜

**åŸå› **ï¼šlocalStorage ä¸­å¯èƒ½æœ‰æ—§çš„é”™è¯¯æ•°æ®

**æ¸…ç†æ­¥éª¤**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. è¿›å…¥ `Application` â†’ `Local Storage`
3. åˆ é™¤ä»¥ä¸‹é”®ï¼š
   - `user_learning_cards`
   - `team_stats_*`
   - `team_referrals_*`
   - `user_transactions`ï¼ˆå¦‚æœæœ‰å¼‚å¸¸ï¼‰

**æˆ–è€…åœ¨ä»£ç ä¸­æ·»åŠ æ¸…ç†é€»è¾‘**ï¼š

```javascript
// ä¸´æ—¶æ¸…ç†è„šæœ¬ï¼ˆåœ¨ç™»å½•åæ‰§è¡Œä¸€æ¬¡ï¼‰
localStorage.removeItem('user_learning_cards')
localStorage.removeItem('user_transactions')
// æ¸…ç†æ‰€æœ‰teamç¼“å­˜
Object.keys(localStorage).forEach(key => {
  if (key.startsWith('team_')) {
    localStorage.removeItem(key)
  }
})
```

---

### ä¿®å¤3ï¼šç¡®ä¿ referral_relationships è¡¨æ•°æ®æ­£ç¡®

**æ£€æŸ¥æ­¥éª¤**ï¼š

1. æ‰“å¼€ Supabase SQL Editor
2. æ‰§è¡Œä»¥ä¸‹SQLæŸ¥è¯¢æ‰€æœ‰ç›´æ¨å…³ç³»ï¼š

```sql
SELECT 
  r.id,
  r.created_at,
  referrer.username as æ¨èäºº,
  referrer.is_agent as æ¨èäººæ˜¯å¦ä»£ç†,
  referee.username as è¢«æ¨èäºº,
  referee.is_agent as è¢«æ¨èäººæ˜¯å¦ä»£ç†
FROM referral_relationships r
JOIN users referrer ON r.referrer_id = referrer.id
JOIN users referee ON r.referee_id = referee.id
WHERE r.is_active = true
ORDER BY r.created_at DESC;
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ‰€æœ‰ `è¢«æ¨èäººæ˜¯å¦ä»£ç†` éƒ½åº”è¯¥æ˜¯ `true`
- âŒ å¦‚æœæœ‰ `false`ï¼Œè¯´æ˜æ•°æ®æœ‰é—®é¢˜

**æ¸…ç†é”™è¯¯æ•°æ®**ï¼š

```sql
-- åˆ é™¤éAIä»£ç†çš„ç›´æ¨å…³ç³»è®°å½•
DELETE FROM referral_relationships
WHERE referee_id IN (
  SELECT id FROM users WHERE is_agent = false
);
```

---

### ä¿®å¤4ï¼šç¡®ä¿æ³¨å†Œæ—¶ä¸å»ºç«‹ç›´æ¨å…³ç³»

**æ£€æŸ¥æ–‡ä»¶**ï¼š
- `src/stores/auth.ts` - `register()` å‡½æ•°
- `src/views/auth/RegisterView.vue`

**ç¡®è®¤é€»è¾‘**ï¼š
- âœ… æ³¨å†Œæ—¶**ä¸**æ’å…¥ `referral_relationships` è®°å½•
- âœ… åªæœ‰å‡çº§AIä»£ç†æ—¶æ‰æ’å…¥

---

## ğŸ¯ å®Œæ•´çš„ä¸šåŠ¡æµç¨‹ï¼ˆæ­£ç¡®ç‰ˆï¼‰

### 1ï¸âƒ£ ç”¨æˆ·æ³¨å†Œ
```
1. å¡«å†™ç”¨æˆ·åã€å¯†ç 
2. åˆ›å»º users è®°å½•
3. âœ… ä¸å»ºç«‹ä»»ä½•æ¨èå…³ç³»
4. âœ… ä¸å‘æ”¾ä»»ä½•å¥–åŠ±
```

### 2ï¸âƒ£ å‡çº§AIä»£ç†
```
1. è¾“å…¥é‚€è¯·ç 
2. éªŒè¯é‚€è¯·äººï¼ˆå¿…é¡»æ˜¯AIä»£ç†ï¼‰
3. æ‰£é™¤30U
4. è®¾ç½® is_agent = true
5. âœ… æ’å…¥ referral_relationships è®°å½•
6. èµ é€100äº’è½¬ç§¯åˆ†ï¼ˆtransfer_points +100ï¼‰
7. èµ é€100æ€»ç§¯åˆ†ï¼ˆpoints_balance +100ï¼‰
8. âŒ ä¸åˆ›å»ºå­¦ä¹ å¡
```

### 3ï¸âƒ£ å…‘æ¢å­¦ä¹ å¡
```
1. ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»"ç«‹å³å…‘æ¢"
2. é€‰æ‹©æ•°é‡ï¼ˆ1-10å¼ ï¼‰
3. æ‰£é™¤8U Ã— æ•°é‡
4. åˆ›å»ºå­¦ä¹ å¡è®°å½•ï¼ˆlocalStorageï¼‰
```

### 4ï¸âƒ£ å›¢é˜Ÿæ˜¾ç¤º
```
1. æŸ¥è¯¢ referral_relationships è¡¨
2. âœ… è¿‡æ»¤ is_agent = true
3. æ˜¾ç¤ºç›´æ¨åˆ—è¡¨
```

---

## ğŸ“‹ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šæ¸…ç†æ•°æ®åº“é”™è¯¯æ•°æ®
```sql
-- åˆ é™¤éAIä»£ç†çš„ç›´æ¨å…³ç³»è®°å½•
DELETE FROM referral_relationships
WHERE referee_id IN (
  SELECT id FROM users WHERE is_agent = false
);
```

### æ­¥éª¤2ï¼šä¿®å¤å›¢é˜Ÿåˆ—è¡¨ä»£ç 
- åœ¨ `TeamView.vue` ç¬¬398è¡Œæ·»åŠ è¿‡æ»¤é€»è¾‘

### æ­¥éª¤3ï¼šæ¸…ç†ç”¨æˆ·æœ¬åœ°ç¼“å­˜
- è®©ç”¨æˆ·æ¸…ç† localStorage æˆ–åˆ·æ–°é¡µé¢

---

## âš ï¸ å»ºè®®

1. **ç«‹å³æ¸…ç†æ•°æ®åº“ä¸­çš„é”™è¯¯æ•°æ®**
2. **ä¿®å¤ä»£ç ä¸­çš„è¿‡æ»¤é€»è¾‘**
3. **é€šçŸ¥ç”¨æˆ·æ¸…ç†ç¼“å­˜æˆ–å¼ºåˆ¶åˆ·æ–°**
4. **æ·»åŠ æ•°æ®éªŒè¯**ï¼šç¡®ä¿ `referral_relationships` è¡¨ä¸­çš„ `referee_id` å¿…é¡»æ˜¯AIä»£ç†

---

**ä¿®å¤å®Œæˆåï¼Œä¸šåŠ¡é€»è¾‘åº”è¯¥æ¢å¤æ­£å¸¸ï¼**


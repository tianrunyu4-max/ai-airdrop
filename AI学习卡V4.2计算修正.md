# AI学习卡 V4.2 计算修正

**修正日期**：2025-10-15  
**问题**：释放量计算基数错误

---

## ❌ 错误计算（修正前）

### 错误逻辑

```typescript
// ❌ 基于初始投入100积分计算
const dailyRelease = machine.initial_points * releaseRate
// 100积分 × 1% = 1积分/天
// 100积分 × 10% = 10积分/天
```

### 错误结果

| 释放率 | 日释放量 | 70%到U | 出局天数 |
|--------|---------|--------|---------|
| 1% | 1积分 | 0.056U | 300天 |
| 10% | 10积分 | 0.56U | 30天 |

---

## ✅ 正确计算（修正后）

### 正确逻辑

```typescript
// ✅ 基于总产出300积分计算
const dailyRelease = machine.total_points * releaseRate
// 300积分 × 1% = 3积分/天
// 300积分 × 10% = 30积分/天
```

### 正确结果

| 释放率 | 日释放量 | 70%到U | 30%销毁 | 出局天数 |
|--------|---------|--------|---------|---------|
| **1%** | **3积分** | **0.168U** | **0.9积分** | **100天** |
| **2%** | **6积分** | **0.336U** | **1.8积分** | **50天** |
| **5%** | **15积分** | **0.84U** | **4.5积分** | **20天** |
| **10%** | **30积分** | **1.68U** | **9积分** | **10天** |

---

## 📊 完整释放率对照表

| 直推数 | 释放率 | 日释放量 | 70%到U | 30%销毁 | 出局天数 |
|--------|-------|---------|--------|---------|---------|
| 0人 | 1% | 3积分 | 0.168U | 0.9积分 | 100天 |
| 1人 | 2% | 6积分 | 0.336U | 1.8积分 | 50天 |
| 2人 | 3% | 9积分 | 0.504U | 2.7积分 | 33天 |
| 3人 | 4% | 12积分 | 0.672U | 3.6积分 | 25天 |
| 4人 | 5% | 15积分 | 0.84U | 4.5积分 | 20天 |
| 5人 | 6% | 18积分 | 1.008U | 5.4积分 | 17天 |
| 6人 | 7% | 21积分 | 1.176U | 6.3积分 | 14天 |
| 7人 | 8% | 24积分 | 1.344U | 7.2积分 | 13天 |
| 8人 | 9% | 27积分 | 1.512U | 8.1积分 | 11天 |
| **9人+** | **10%** | **30积分** | **1.68U** | **9积分** | **10天** |

---

## 💰 收益计算（1张学习卡）

### 投入成本

```
购买成本：8U
或
成为代理：30U（送1张学习卡）
```

### 总产出

```
总释放：300积分
  ├─ 70%到账：210积分 = 210 × 0.08 = 16.8U
  └─ 30%销毁：90积分（清0防泡沫）

净收益：16.8U - 8U = 8.8U（110%收益率）
```

### 场景分析

#### 场景1：无直推（1%基础释放率）

```
每天释放：300积分 × 1% = 3积分
  ├─ 70%到账：2.1积分 = 0.168U
  └─ 30%销毁：0.9积分

出局时间：300积分 ÷ 3积分/天 = 100天
累计到账：16.8U
日均收益：0.168U/天
```

#### 场景2：直推5人（6%释放率）

```
每天释放：300积分 × 6% = 18积分
  ├─ 70%到账：12.6积分 = 1.008U
  └─ 30%销毁：5.4积分

出局时间：300积分 ÷ 18积分/天 ≈ 17天
累计到账：16.8U
日均收益：1.008U/天（加速6倍）
```

#### 场景3：直推9人+（10%上限）

```
每天释放：300积分 × 10% = 30积分
  ├─ 70%到账：21积分 = 1.68U
  └─ 30%销毁：9积分

出局时间：300积分 ÷ 30积分/天 = 10天
累计到账：16.8U
日均收益：1.68U/天（加速10倍）
```

---

## 🔧 修正内容

### 1. 配置文件（`src/config/mining.ts`）

```typescript
// ✅ 修正
DAILY_OUTPUT: 3,  // 每日产出3积分（300×1%）
```

### 2. 后端逻辑（`src/services/MiningService.ts`）

**修正1：releaseDailyPoints方法**

```typescript
// ❌ 修正前
const dailyRelease = machine.initial_points * dailyReleaseRate

// ✅ 修正后
const dailyRelease = machine.total_points * dailyReleaseRate
```

**修正2：releaseDailyPointsV4方法**

```typescript
// ❌ 修正前
const dailyRelease = machine.initial_points * releaseRate

// ✅ 修正后（基于总产出300积分，而非初始100积分）
const dailyRelease = machine.total_points * releaseRate
```

---

## 📊 对比分析

### 修正前 vs 修正后

| 场景 | 修正前日释放 | 修正后日释放 | 差异 |
|------|------------|------------|------|
| 基础1% | 1积分 | **3积分** | +200% |
| 直推5人(6%) | 6积分 | **18积分** | +200% |
| 上限10% | 10积分 | **30积分** | +200% |

### 出局时间对比

| 场景 | 修正前 | 修正后 | 差异 |
|------|-------|-------|------|
| 基础1% | 300天 | **100天** | 缩短3倍 |
| 直推5人(6%) | 50天 | **17天** | 缩短3倍 |
| 上限10% | 30天 | **10天** | 缩短3倍 |

---

## 🎯 修正后的系统特点

### ✅ 优势

1. **释放量正确**：基于300积分总产出，而非100积分初始投入
2. **出局时间合理**：10-100天（之前30-300天）
3. **收益速度提升**：每日释放量×3
4. **激励推广**：直推越多，越快出局回本
5. **防泡沫机制**：30%销毁仍然有效

### 📊 经济模型

```
单张学习卡：
  投入：8U（或成为代理送1张）
  产出：16.8U（110%收益率）
  周期：10-100天（根据直推数）

系统通缩：
  每日释放积分中30%销毁
  积分总量受控，不会无限增长
```

---

## 🧪 测试建议

### 1. 释放量测试

- [ ] 无直推签到：释放3积分（300×1%）
- [ ] 1个直推：释放6积分（300×2%）
- [ ] 5个直推：释放18积分（300×6%）
- [ ] 9个直推：释放30积分（300×10%）

### 2. 分配测试

- [ ] 3积分释放：70%=2.1积分→0.168U，30%=0.9积分销毁
- [ ] 30积分释放：70%=21积分→1.68U，30%=9积分销毁

### 3. 出局测试

- [ ] 基础1%：100天出局（累计300积分）
- [ ] 上限10%：10天出局（累计300积分）

---

## 📦 修改的文件

1. ✅ `src/config/mining.ts`
   - `DAILY_OUTPUT: 1` → `DAILY_OUTPUT: 3`

2. ✅ `src/services/MiningService.ts`
   - `releaseDailyPoints`: `initial_points` → `total_points`
   - `releaseDailyPointsV4`: `initial_points` → `total_points`

---

## 🎉 修正总结

**核心问题**：释放量基于初始投入100积分计算，而非总产出300积分

**修正结果**：
- ✅ 日释放量×3（更合理）
- ✅ 出局时间÷3（10-100天）
- ✅ 日均收益×3（0.168U-1.68U/天）
- ✅ 保持110%收益率不变

**影响**：
- 用户体验更好（更快出局回本）
- 系统更活跃（周期缩短）
- 防泡沫机制仍有效（30%销毁）

---

**修正完成时间**：2025-10-15  
**当前版本**：V4.2（计算已修正）


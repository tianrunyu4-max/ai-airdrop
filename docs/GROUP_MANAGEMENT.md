# 群聊分类和多群功能说明

## 📋 功能概述

实现了完整的群聊分类和多群管理系统，支持：
- 群聊分类管理
- 多个群组创建
- 每个群可配置独立的AI机器人
- 群容量扩展到10万人

## 🗂️ 数据库结构

### 1. 群聊分类表 (chat_categories)
```sql
- id: UUID
- name: 分类名称
- description: 分类描述
- icon: 图标（Emoji）
- sort_order: 排序
- is_active: 是否启用
- created_at: 创建时间
- updated_at: 更新时间
```

### 2. 群组表 (chat_groups) - 新增字段
```sql
- category_id: 所属分类
- description: 群组描述
- icon: 群组图标
- sort_order: 排序
- is_active: 是否启用
- bot_enabled: 是否启用机器人
- bot_config: 机器人配置（JSON）
- max_members: 最大成员数（默认10万）
```

### 3. 机器人配置 (bot_config JSON)
```json
{
  "bot_name": "AI机器人名称",
  "push_interval": 3600,  // 推送间隔（秒）
  "welcome_message": "欢迎消息",
  "exchange_filter": "binance",  // 交易所过滤（可选）
  "min_score": 8.0  // 最低评分（可选）
}
```

## 🚀 部署步骤

### 1. 运行数据库迁移
```bash
# 在Supabase SQL Editor中运行
supabase/migration_chat_categories.sql
```

这个脚本会：
- ✅ 创建 `chat_categories` 表
- ✅ 为 `chat_groups` 添加新字段
- ✅ 更新群容量为10万
- ✅ 插入5个默认分类
- ✅ 创建5个示例群组（含机器人配置）
- ✅ 配置RLS策略

### 2. 默认分类
系统会自动创建以下分类：
1. 💬 综合交流
2. 🎁 空投推荐
3. 📈 交易策略
4. 🔍 项目分析
5. 📚 新手指南

### 3. 示例群组
系统会自动创建以下群组：
1. 🏛️ AI科技大厅（主群，启用AI助手）
2. 🟡 币安空投专区（启用币安空投机器人）
3. ⚫ OKX空投专区（启用OKX空投机器人）
4. ⭐ 高分空投推荐（启用高分推荐机器人，评分≥8.0）
5. 📊 合约交易策略（未启用机器人）

## 🎨 前端功能

### 1. 用户端 - 群组选择器
- **位置**: 聊天页面右上角
- **功能**:
  - 按分类浏览所有群组
  - 查看群组信息（成员数、机器人状态）
  - 一键切换群组
  - 显示当前所在群组

### 2. 管理后台 - 群聊管理
- **路由**: `/admin/groups`
- **功能**:
  - 分类管理（新建、编辑、启用/禁用）
  - 群组管理（新建、编辑、启用/禁用）
  - 机器人配置
  - 排序管理

## 📱 使用方法

### 用户端
1. 进入聊天页面
2. 点击右上角"切换群聊"按钮
3. 浏览分类和群组
4. 点击任意群组进入

### 管理员
1. 登录管理后台
2. 进入"群聊管理"菜单
3. 管理分类和群组

#### 新建分类
1. 点击"新建分类"
2. 填写分类信息（名称、描述、图标、排序）
3. 保存

#### 新建群组
1. 点击"新建群组"
2. 填写基本信息（名称、描述、图标、分类）
3. 设置容量和排序
4. 配置AI机器人（可选）
   - 启用机器人开关
   - 设置机器人名称
   - 设置推送间隔
   - 设置欢迎消息
   - 设置过滤条件（交易所、评分）
5. 保存

## 🤖 机器人配置说明

### 推送间隔 (push_interval)
- 单位：秒
- 建议值：
  - 主群：3600（1小时）
  - 专区群：1800（30分钟）
  - 高频群：600（10分钟）

### 交易所过滤 (exchange_filter)
- 可选值：`binance`, `okx`, `coinbase` 等
- 留空：推送所有交易所

### 最低评分 (min_score)
- 范围：0-10
- 留空：推送所有评分
- 建议：8.0（高质量空投）

## 🔧 技术细节

### 前端组件
- `src/components/GroupSelector.vue` - 群组选择器
- `src/views/chat/ChatView.vue` - 聊天页面（集成群组切换）
- `src/views/admin/GroupManagement.vue` - 管理后台

### 类型定义
- `src/types/index.ts` - 新增 `ChatCategory`, `BotConfig` 接口

### 路由
- `/admin/groups` - 群聊管理页面

## 📊 数据统计

管理后台显示：
- 每个分类下的群组数量
- 每个群组的成员数
- 机器人启用状态
- 群组活跃状态

## 🔐 权限控制

### RLS策略
- **分类表**: 所有人可查看活跃分类，管理员可管理
- **群组表**: 所有人可查看活跃群组

### 路由守卫
- 群聊管理页面需要管理员权限

## 🎯 未来扩展

可以进一步扩展的功能：
1. 群组权限管理（管理员、禁言）
2. 群组公告系统
3. 群组统计（活跃度、消息量）
4. 机器人智能推送（基于用户偏好）
5. 群组搜索功能
6. 群组标签系统

## ✅ 测试清单

- [ ] 运行数据库迁移脚本
- [ ] 验证默认分类和群组创建
- [ ] 测试用户端群组切换
- [ ] 测试管理后台分类管理
- [ ] 测试管理后台群组管理
- [ ] 测试机器人配置保存
- [ ] 测试RLS权限

## 🐛 故障排除

### 问题1：群组选择器不显示
- 检查数据库迁移是否成功
- 检查RLS策略是否正确

### 问题2：无法创建群组
- 检查管理员权限
- 检查表单验证

### 问题3：机器人不推送
- 检查 `bot_enabled` 是否为 `true`
- 检查 `bot_config` 是否正确
- 开发模式下机器人才会自动推送

---

**完成时间**: 2025-10-05
**版本**: v1.0.0








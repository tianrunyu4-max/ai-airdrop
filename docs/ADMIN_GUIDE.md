# 🔐 管理后台使用指南

## 访问管理后台

### 1. 创建管理员账户

首先需要在Supabase中创建第一个管理员账户：

#### 方法1：通过SQL编辑器

```sql
-- 在Supabase SQL Editor中运行：

-- 1. 手动将某个用户设置为管理员
UPDATE users 
SET is_admin = TRUE 
WHERE username = 'your_username';

-- 2. 或者运行迁移脚本
-- 上传并执行 supabase/migrations/001_add_admin_field.sql
```

#### 方法2：通过Supabase Dashboard

1. 进入 Supabase → Table Editor → users
2. 找到你的用户记录
3. 编辑 `is_admin` 字段，改为 `true`
4. 保存

### 2. 登录管理后台

1. 使用管理员账户登录前端应用
2. 访问：`http://localhost:3000/admin` 或 `https://your-domain.com/admin`
3. 自动跳转到管理后台仪表盘

---

## 功能模块

### 📊 仪表盘 (`/admin/dashboard`)

**功能：**
- 总用户数统计
- 代理用户数统计
- 待审核提现数量
- 平台总收益
- 最新注册用户
- 最新提现申请
- 快速操作入口

**数据更新：**
- 页面加载时自动刷新
- 点击"刷新数据"按钮手动更新

---

### 👥 用户管理 (`/admin/users`)

**功能：**
- 查看所有用户列表
- 搜索用户（用户名/邀请码）
- 筛选（全部/代理/普通用户）
- 查看用户详情
- 调整用户余额（U余额/积分余额）

**余额调整：**
1. 点击用户行的"调整余额"按钮
2. 选择调整类型（U余额/积分余额）
3. 输入调整金额（正数增加，负数减少）
4. 填写备注说明（必填）
5. 确认调整

**注意事项：**
- 余额调整会自动记录到交易表
- 调整操作不可撤销，请谨慎操作
- 建议在备注中详细说明调整原因

---

### 💰 提现审核 (`/admin/withdrawals`)

**功能：**
- 查看所有提现申请
- 筛选状态（待审核/已通过/已拒绝/已完成）
- 审核提现申请
- 查看提现详情

**审核流程：**

#### 通过提现：
1. 点击"通过"按钮
2. （可选）填写审核备注
3. 确认操作
4. 系统记录审核时间和操作人

#### 拒绝提现：
1. 点击"拒绝"按钮
2. **必须**填写拒绝原因
3. 确认操作
4. 系统自动退还用户余额
5. 记录审核时间和原因

**注意事项：**
- 通过后需要手动转账给用户
- 拒绝会自动退还余额
- 审核操作不可撤销

---

### 🚀 空投管理 (`/admin/airdrops`)

**功能：**
- 查看所有空投信息
- 手动添加空投
- 编辑空投信息
- 启用/停用空投

**添加空投：**
1. 点击"手动添加空投"按钮
2. 填写空投信息：
   - 交易所（币安/OKX）
   - 标题
   - 描述
   - 奖励
   - 开始/结束时间
   - AI评分（0-10）
   - 活动链接
3. 保存

**编辑空投：**
1. 点击空投行的"编辑"按钮
2. 修改信息
3. 保存

**启用/停用：**
- 点击"停用"按钮可以隐藏空投（用户端不可见）
- 点击"启用"按钮恢复显示

---

### ⚙️ 系统配置 (`/admin/system`)

**功能：**
- 修改系统参数
- 触发矿机重启机制（危险操作）

**可配置参数：**

| 参数 | 说明 | 默认值 |
|------|------|--------|
| 代理费用 | 成为代理需要支付的费用（U） | 30 |
| 见点奖 | 网体内新增代理的奖励（U） | 8 |
| 平级见点奖 | 每级平级见点奖金额（U） | 3 |
| 平级见点奖层级 | 向上计算的层级数 | 5 |
| 直推分红每单 | 每次分红发放金额（U） | 7 |
| 分红最低直推人数 | 达到此人数才有分红资格 | 5 |
| 复购提示阈值 | 总收益达到此金额提示复购（U） | 300 |
| 复购费用 | 复购所需费用（U） | 30 |
| 最低提现金额 | 用户提现的最低金额（U） | 20 |
| 积分兑换U比例 | 100积分可兑换多少U | 0.07 (即7U) |
| U提现比例 | 积分兑换U后可提现比例 | 0.7 (70%) |
| 互转流通比例 | 积分兑换U后用于互转比例 | 0.3 (30%) |

**修改配置：**
1. 修改参数值
2. 点击"保存配置"按钮
3. 系统立即生效

**⚠️ 矿机重启机制：**

**触发条件：**
- 管理员手动触发
- 用于系统维护或重大调整

**影响：**
1. 所有矿机状态重置
2. 所有用户积分销毁30%
3. 矿机重新排队释放

**操作步骤：**
1. 点击"触发矿机重启"按钮
2. 在弹窗中输入 `RESTART` 确认
3. 确认操作

**⚠️ 警告：此操作不可撤销，会影响所有用户！**

---

## 安全性说明

### 权限控制

1. **路由守卫**
   - 未登录用户无法访问
   - 非管理员用户访问 `/admin` 会显示404

2. **数据库RLS**
   - 所有管理后台API都有Supabase RLS保护
   - 只有 `is_admin = true` 的用户可以访问管理数据

3. **操作日志**
   - 所有管理员操作都会记录到 `admin_logs` 表
   - 包括操作时间、操作类型、目标对象等

### 数据安全

1. **敏感操作**
   - 余额调整需要填写备注
   - 提现拒绝需要填写原因
   - 矿机重启需要二次确认

2. **数据备份**
   - 建议定期备份Supabase数据库
   - 重要操作前先备份

---

## 常见问题

### Q: 如何添加新的管理员？

A: 在Supabase Dashboard中，将用户的 `is_admin` 字段改为 `true`

### Q: 忘记管理员账户怎么办？

A: 通过Supabase Dashboard直接修改数据库

### Q: 管理后台无法访问？

A: 检查：
1. 是否已登录
2. 当前用户的 `is_admin` 是否为 `true`
3. 路由是否正确

### Q: 数据不更新？

A: 点击"刷新"按钮或刷新页面

### Q: 可以删除用户吗？

A: 当前版本不支持删除用户，只能调整余额和状态

---

## 后续优化建议

### 短期（1-2周）
- [ ] 添加管理员操作日志查看页面
- [ ] 添加数据导出功能（Excel/CSV）
- [ ] 添加图表统计（Chart.js或ECharts）
- [ ] 添加批量操作功能

### 中期（1个月）
- [ ] 添加权限分级（超级管理员/普通管理员）
- [ ] 添加通知系统（站内信）
- [ ] 添加自动化报表
- [ ] 添加数据备份功能

### 长期（2-3个月）
- [ ] 添加风控系统
- [ ] 添加智能预警
- [ ] 添加API接口文档
- [ ] 添加移动端管理APP

---

## 技术支持

如有问题请联系开发团队或查看相关文档：
- [开发指南](DEVELOPMENT.md)
- [部署指南](DEPLOYMENT.md)
- [项目总结](../PROJECT_SUMMARY.md)

---

© 2025 AI智能空投平台 - 管理后台







# 🤖 空投自动推送使用指南

## 📋 系统概述

系统自动爬取 **币安** 和 **欧易（OKX）** 的去中心化项目空投资讯，并支持：
- ✅ **自动推送**：每2小时自动推送到核心群
- ✅ **手动推送**：管理员可选择推送到其他群组

---

## 🔧 一、配置RSS源

### 当前配置的RSS源

| 交易所 | 名称 | 自动推送 | 状态 |
|--------|------|---------|------|
| **币安** | 币安公告（空投/Launchpool） | ✅ 是 | 🟢 已启用 |
| **欧易** | OKX（欧易）公告 | ✅ 是 | 🟢 已启用 |
| 其他 | CoinMarketCap 空投 | ❌ 否 | 🟢 已启用 |

### RSS源地址
- 币安：`https://www.binance.com/en/support/announcement/rss`
- 欧易：`https://www.okx.com/support/hc/en-us/articles/rss`
- CMC：`https://coinmarketcap.com/airdrop/rss.xml`

---

## 🚀 二、自动推送设置（2小时一次）

### 方式1：Supabase Edge Function（推荐）

#### 1. 创建 Edge Function

在 `supabase/functions/auto-crawl-airdrops/index.ts`：

```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'

serve(async (req) => {
  try {
    console.log('🕷️ 开始自动爬取空投...')
    
    // 调用爬取API
    const response = await fetch('https://eth10.netlify.app/api/airdrop/crawl', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${Deno.env.get('SERVICE_KEY')}`
      }
    })
    
    const result = await response.json()
    
    console.log('✅ 爬取完成:', result)
    
    return new Response(JSON.stringify(result), {
      headers: { 'Content-Type': 'application/json' }
    })
  } catch (error) {
    console.error('❌ 爬取失败:', error)
    return new Response(JSON.stringify({ error: error.message }), {
      status: 500
    })
  }
})
```

#### 2. 设置 Cron Job

在 Supabase Dashboard → Database → Cron Jobs：

```sql
-- 每2小时执行一次（整点）
SELECT cron.schedule(
  'auto-crawl-airdrops-2h',
  '0 */2 * * *', -- 每2小时的0分执行（0:00, 2:00, 4:00...）
  $$
  SELECT net.http_post(
    url := 'https://your-project.supabase.co/functions/v1/auto-crawl-airdrops',
    headers := jsonb_build_object(
      'Content-Type', 'application/json',
      'Authorization', 'Bearer YOUR_SERVICE_KEY'
    )
  );
  $$
);
```

### 方式2：管理后台手动触发（临时方案）

1. 登录管理后台
2. 进入 **空投管理** 页面
3. 点击 **"🕷️ 自动爬取"** 按钮
4. 系统自动爬取并推送到核心群

---

## 📱 三、手动推送操作流程

### 步骤1：进入管理后台

```
https://eth10.netlify.app/admin/login
```

### 步骤2：查看空投列表

1. 点击左侧菜单 **"空投管理"**
2. 查看所有已爬取的空投信息
3. 每条空投显示：
   - 标题
   - 交易所（币安/欧易/其他）
   - AI评分
   - 奖励金额
   - 创建时间

### 步骤3：手动推送到群组

1. 找到要推送的空投
2. 点击 **"📢 推送"** 按钮
3. 选择目标群组（可多选）：
   - ✅ 核心群（默认自动推送）
   - ✅ 代理群1
   - ✅ 代理群2
   - ✅ VIP群
4. 点击 **"确认推送"**
5. 系统显示推送结果：
   ```
   推送完成！
   成功：3个群组
   失败：0个群组
   ```

---

## 🔍 四、推送规则说明

### 自动推送（每2小时）

| 触发方式 | 推送目标 | 来源 | 特点 |
|---------|---------|------|------|
| 定时任务 | 核心群（主群） | 币安 + 欧易 | 仅推送高质量空投 |
| 爬取频率 | 2小时/次 | RSS自动爬取 | AI评分 ≥ 7分 |

**推送消息格式**：
```
━━━━━━━━━━━━━━━━━━━━
🎁 自动空投通知

【标题】BNB质押空投
【交易所】BINANCE
【奖励】预计50 USDT
【AI评分】8.5/10

【说明】质押BNB即可获得奖励...

【链接】https://binance.com/...

━━━━━━━━━━━━━━━━━━━━
💡 每2小时自动爬取，立即参与！
━━━━━━━━━━━━━━━━━━━━
```

### 手动推送

| 触发方式 | 推送目标 | 来源 | 特点 |
|---------|---------|------|------|
| 管理员操作 | 自选群组 | 所有来源 | 可推送任何空投 |
| 推送频率 | 按需推送 | 包括CMC等 | 不限评分 |

**推送消息格式**：
```
━━━━━━━━━━━━━━━━━━━━
🎁 新空投通知（管理员推送）

【标题】OKX质押奖励
【交易所】OKX
【奖励】预计30 USDT
【AI评分】7.8/10

【说明】持有OKB即可参与...

【链接】https://okx.com/...

━━━━━━━━━━━━━━━━━━━━
💡 立即参与，早鸟有奖！
━━━━━━━━━━━━━━━━━━━━
```

---

## 📊 五、AI评分规则

系统自动对每个空投进行AI智能评分（1-10分）：

| 评分项 | 加分 | 说明 |
|-------|------|------|
| 基础分 | 5分 | 所有空投基础分 |
| 币安来源 | +3分 | 币安官方空投 |
| 欧易来源 | +2分 | 欧易官方空投 |
| 明确奖励 | +1分 | 有具体金额说明 |
| 官方标识 | +1分 | 标题含"官方"关键词 |

**评分等级**：
- 🔥 **9-10分**：强烈推荐（高质量）
- ⭐ **7-8分**：推荐参与
- 💡 **5-6分**：谨慎参与
- ⚠️ **<5分**：不推荐

**自动推送过滤**：只有 **≥7分** 的空投才会自动推送到核心群。

---

## 🛠️ 六、故障排查

### 问题1：自动推送不工作

**检查步骤**：
1. 确认 Supabase Cron Job 已创建
2. 查看 Supabase Logs：`Database → Cron Jobs → Logs`
3. 检查 Edge Function 是否部署
4. 验证 Service Key 是否正确

**临时方案**：手动触发爬取（管理后台）

### 问题2：手动推送失败

**可能原因**：
- 群组不存在或已禁用
- 网络连接问题
- Supabase 权限问题

**解决方法**：
1. 进入 **群组管理**，确认群组状态为"活跃"
2. 检查浏览器控制台错误
3. 刷新页面重试

### 问题3：爬取到的空投质量低

**优化方法**：
1. 调整 AI 评分规则（提高阈值）
2. 添加更多关键词过滤
3. 只启用高质量RSS源（币安+欧易）

---

## 📝 七、管理员操作清单

### 每日任务
- [ ] 检查自动推送是否正常（查看核心群消息）
- [ ] 查看新爬取的空投列表
- [ ] 手动推送优质空投到其他群

### 每周任务
- [ ] 查看 Cron Job 执行日志
- [ ] 检查空投数据库清理（删除过期空投）
- [ ] 优化 AI 评分规则（根据用户反馈）

### 按需任务
- [ ] 添加/删除 RSS 源
- [ ] 调整推送频率（默认2小时）
- [ ] 测试新功能

---

## 🎯 八、快速参考

### 重要链接
- 管理后台：`https://eth10.netlify.app/admin`
- 空投管理：`https://eth10.netlify.app/admin/airdrops`
- 群组管理：`https://eth10.netlify.app/admin/groups`

### 关键命令（Supabase SQL）

**查看Cron Job状态**：
```sql
SELECT * FROM cron.job WHERE jobname = 'auto-crawl-airdrops-2h';
```

**手动执行一次**：
```sql
SELECT cron.schedule(
  'test-crawl-once',
  '* * * * *',
  $$ SELECT 1; $$
);
SELECT cron.unschedule('test-crawl-once');
```

**查看最近的空投**：
```sql
SELECT title, exchange, ai_score, created_at 
FROM airdrops 
WHERE is_active = true 
ORDER BY created_at DESC 
LIMIT 10;
```

---

## 💡 九、最佳实践

1. **自动推送设置为核心群**：避免打扰其他群用户
2. **手动推送前预览**：确认内容质量再推送
3. **定期清理过期空投**：保持数据库整洁
4. **监控推送效果**：根据用户反馈调整策略
5. **测试新RSS源**：确保质量后再启用

---

**需要帮助？** 联系技术支持或查看详细文档。


# 🔥 对碰逻辑详解（V5.0）

**更新时间：** 2025-10-22  
**重要：** 之前的示例有误，这是正确的逻辑！

---

## 🎯 核心对碰规则

### **配对比例：2:1 或 1:2（灵活配对）**

```typescript
// 配置参数
PAIRING: {
  BONUS_PER_PAIR: 8,             // 每对奖励8U
  MEMBER_RATIO: 0.85,            // 85%到账（6.8U）
  RATIO: '2:1_OR_1:2',           // 对碰比例
  REQUIRED_UNITS: {
    TWO_ONE: { A: 2, B: 1 },     // 2:1 配对：A区2单 + B区1单 = 1对
    ONE_TWO: { A: 1, B: 2 }      // 1:2 配对：A区1单 + B区2单 = 1对
  }
}
```

---

## 📊 对碰计算逻辑（代码实现）

### **算法：**
```typescript
function calculatePairing(aPending, bPending) {
  // 优先检查 2:1 配对
  if (aPending >= 2 && bPending >= 1) {
    pairs = Math.min(
      Math.floor(aPending / 2),  // A区可以配几对
      Math.floor(bPending / 1)   // B区可以配几对
    )
    return { pairs, type: '2:1' }
  }
  
  // 否则检查 1:2 配对
  if (aPending >= 1 && bPending >= 2) {
    pairs = Math.min(
      Math.floor(aPending / 1),  // A区可以配几对
      Math.floor(bPending / 2)   // B区可以配几对
    )
    return { pairs, type: '1:2' }
  }
  
  return null  // 不足以配对
}
```

---

## ✅ 正确示例

### **示例1：A区5单，B区5单**

```
当前业绩：
- A区：5单（pending）
- B区：5单（pending）

对碰计算（优先2:1）：
- 2:1配对检查：
  - A区可配：5 ÷ 2 = 2对（向下取整）
  - B区可配：5 ÷ 1 = 5对
  - 实际配对：min(2, 5) = 2对 ✅

结算：
- 消耗：A区4单，B区2单
- 对碰：2对
- 奖励：2对 × 6.8U = 13.6U
- 剩余：A区1单，B区3单（明天继续）

❌ 错误理解：5:5 = 5对（这是1:1配对，现在不是这个规则）
✅ 正确理解：5:5 → 2对（2:1配对，A消耗4单，B消耗2单）
```

### **示例2：A区6单，B区5单**

```
当前业绩：
- A区：6单
- B区：5单

对碰计算（优先2:1）：
- 2:1配对检查：
  - A区可配：6 ÷ 2 = 3对
  - B区可配：5 ÷ 1 = 5对
  - 实际配对：min(3, 5) = 3对 ✅

结算：
- 消耗：A区6单，B区3单
- 对碰：3对
- 奖励：3对 × 6.8U = 20.4U
- 剩余：A区0单，B区2单
```

### **示例3：A区3单，B区5单**

```
当前业绩：
- A区：3单
- B区：5单

对碰计算（优先2:1）：
- 2:1配对检查：
  - A区可配：3 ÷ 2 = 1对（向下取整）
  - B区可配：5 ÷ 1 = 5对
  - 实际配对：min(1, 5) = 1对 ✅

结算：
- 消耗：A区2单，B区1单
- 对碰：1对
- 奖励：1对 × 6.8U = 6.8U
- 剩余：A区1单，B区4单
```

### **示例4：A区1单，B区5单（改用1:2配对）**

```
当前业绩：
- A区：1单
- B区：5单

对碰计算：
- 2:1配对检查：
  - A区：1单 < 2单 ❌ 不足以2:1配对
- 1:2配对检查：
  - A区可配：1 ÷ 1 = 1对
  - B区可配：5 ÷ 2 = 2对（向下取整）
  - 实际配对：min(1, 2) = 1对 ✅

结算：
- 消耗：A区1单，B区2单
- 对碰：1对（1:2配对）
- 奖励：1对 × 6.8U = 6.8U
- 剩余：A区0单，B区3单
```

---

## 🔢 对碰公式总结

### **2:1配对公式：**
```
条件：A ≥ 2 且 B ≥ 1
对数 = min(A ÷ 2, B ÷ 1)  [向下取整]
消耗：A区减少 (对数 × 2)，B区减少 (对数 × 1)
奖励：对数 × 6.8U
```

### **1:2配对公式：**
```
条件：A ≥ 1 且 B ≥ 2
对数 = min(A ÷ 1, B ÷ 2)  [向下取整]
消耗：A区减少 (对数 × 1)，B区减少 (对数 × 2)
奖励：对数 × 6.8U
```

### **优先级：**
```
1. 优先检查 2:1 配对
2. 如果不满足，检查 1:2 配对
3. 如果都不满足，等待下次结算
```

---

## 📈 收益对比（不同配对比例）

### **假设100单业绩分布：**

| A区 | B区 | 1:1配对 | 2:1配对 | 收益差异 |
|-----|-----|---------|---------|----------|
| 50单 | 50单 | 50对 | 25对 | 1:1更快 |
| 60单 | 40单 | 40对 | 30对 | 1:1更快 |
| 70单 | 30单 | 30对 | 30对 | 持平 |
| 80单 | 20单 | 20对 | 20对 | 持平 |
| 90单 | 10单 | 10对 | 10对 | 持平 |

**结论：**
- **2:1/1:2配对更灵活**，适合AB区不平衡的情况
- **但配对效率低于1:1**（相同单量下对碰次数更少）

---

## 💡 为什么用2:1/1:2而不是1:1？

### **优势：**
1. ✅ **更灵活**：AB区不平衡时也能配对
2. ✅ **减少等待**：不需要完全1:1才能配对
3. ✅ **鼓励推广**：单边发展也有收益

### **劣势：**
1. ❌ **效率降低**：同样单量，对碰次数减少
2. ❌ **收益减少**：相同业绩下收益降低

---

## 🎯 实际运营策略

### **最佳发展比例：**
```
理想比例：A区 : B区 = 2 : 1 或 1 : 2

示例1（推荐）：
- A区：20人（2/3）
- B区：10人（1/3）
- 每天新增：A区2单，B区1单
- 每天对碰：1对 × 6.8U = 6.8U

示例2（不推荐）：
- A区：25人
- B区：5人（严重不平衡）
- 虽然总人数30人，但对碰效率低
- 每天对碰：最多2对（B区限制）
```

---

## ⚠️ 重要更正

### **之前错误示例：**
```
❌ A区5单，B区5单 → 5对（错误！）
   收益：5对 × 6.8U = 34U（错误！）
```

### **正确示例：**
```
✅ A区5单，B区5单 → 2对（2:1配对）
   消耗：A区4单，B区2单
   收益：2对 × 6.8U = 13.6U
   剩余：A区1单，B区3单
```

---

## 🧮 在线计算器（伪代码）

```javascript
function 计算对碰(A区单量, B区单量) {
  // 优先2:1
  if (A区单量 >= 2 && B区单量 >= 1) {
    对数 = Math.min(Math.floor(A区单量 / 2), B区单量)
    消耗A = 对数 * 2
    消耗B = 对数 * 1
    奖励 = 对数 * 6.8
    剩余A = A区单量 - 消耗A
    剩余B = B区单量 - 消耗B
    return { 对数, 奖励, 剩余A, 剩余B, 类型: '2:1' }
  }
  
  // 否则1:2
  if (A区单量 >= 1 && B区单量 >= 2) {
    对数 = Math.min(A区单量, Math.floor(B区单量 / 2))
    消耗A = 对数 * 1
    消耗B = 对数 * 2
    奖励 = 对数 * 6.8
    剩余A = A区单量 - 消耗A
    剩余B = B区单量 - 消耗B
    return { 对数, 奖励, 剩余A, 剩余B, 类型: '1:2' }
  }
  
  return { 对数: 0, 奖励: 0, 提示: '单量不足，无法配对' }
}

// 使用示例
计算对碰(5, 5)
// 结果：{ 对数: 2, 奖励: 13.6, 剩余A: 1, 剩余B: 3, 类型: '2:1' }
```

---

**再次强调：A区5单 + B区5单 = 2对（不是5对！）** 🔥


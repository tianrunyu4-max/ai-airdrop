# 聊天抖动问题修复说明

## 📝 问题描述

用户反馈：聊天页面加载消息时，界面会"抖动"，消息闪烁，需要"抖一下"才能定位到正确位置。

## 🔍 问题原因

1. **消息加载时清空**：切换群组时先清空 `messages.value = []`，导致页面闪烁
2. **DOM重绘**：消息数组频繁替换，引起大量DOM重绘
3. **滚动位置跳动**：消息加载后立即滚动，DOM未完全渲染

## ✅ 解决方案

### 1. 移除消息清空操作

**修改前：**
```typescript
const switchGroup = async (group: any) => {
  currentGroup.value = group
  messages.value = []  // ❌ 清空消息导致闪烁
  await loadMessages(group.id)
}
```

**修改后：**
```typescript
const switchGroup = async (group: any) => {
  currentGroup.value = group
  // ✅ 不清空，直接加载新消息替换
  await loadMessages(group.id)
}
```

### 2. 优化滚动时机

**修改前：**
```typescript
messages.value = formattedMessages
nextTick(() => scrollToBottom())  // 可能DOM未完全渲染
```

**修改后：**
```typescript
messages.value = formattedMessages
await nextTick()
setTimeout(() => scrollToBottom(), 100)  // ✅ 延迟100ms确保渲染完成
```

### 3. 添加CSS硬件加速

```css
/* 平滑滚动 */
.overflow-y-auto {
  scroll-behavior: smooth;
  transform: translateZ(0);  /* 硬件加速 */
  will-change: scroll-position;
}

/* 减少重绘抖动 */
.space-y-4 > * {
  transform: translateZ(0);
  backface-visibility: hidden;
}
```

## 🎯 效果

- ✅ 切换群组时无闪烁
- ✅ 消息加载平滑过渡
- ✅ 滚动位置稳定
- ✅ 整体性能提升

## 📦 部署

代码已推送到GitHub，Vercel会自动重新部署。

**部署状态：** https://vercel.com/dashboard

---

*修复时间：2025-10-20*
*提交哈希：28021b7*

